(function(b){var a=undefined;b.extend({jwAppConfig:{get:function(){if(!a){a=b.jwAjax({url:"/sys/funauthapp/api/getAppConfig/"+WIS_CONFIG.APPNAME+"-"+WIS_CONFIG.APPID+".do",type:"GET",isWrapSuccessCallback:false,async:false})}return a},hasPermission:function(d){var c=false;var e=this.get().MODULES||[];b.each(e,function(f,g){if(g.route===d){c=true;return false}if(b.type(g.buttons)==="array"&&g.buttons.indexOf(d)>=0){c=true;return false}});return c},clear:function(){a=undefined}}})})(jQuery);(function(a){a.extend({bindAutoSearchEvent:function(f){var b=this;var d=[];if(!f.field){var e=null;if(f.datamodel){e=f.datamodel}else{e=WIS_EMAP_SERV.getModel(f.pagePath,f.action,"form")}a.each(e,function(g,h){if(h.quickSearch&&(String(h["search.hidden"])=="false"||(String(h["search.hidden"])=="undefined"&&String(h.hidden)!=="true"))){var i=",tree,select,multi-tree,multi-select,tree2,multi-tree2,multi-select2,date-range,";var j=h["search.quickSearchXtype"]?h["search.quickSearchXtype"]:(h["search.xtype"]?h["search.xtype"]:h.xtype);if(j&&i.indexOf(","+j+",")>-1){d.push(h.name)}}})}else{d=f.field}if(d.length>0&&f.searchCallback){var c=f.bindEventType?f.bindEventType:"close";a.each(d,function(g,h){if(!f.ignoreFields||b.checkIgnoreFields(h,f.ignoreFields)){if(f.bindType=="2"){a(f.queryDom).off(c,'[data-name="'+h+'"]').on(c,'[data-name="'+h+'"]',function(){f.searchCallback()})}else{a(f.queryDom+' [data-name="'+h+'"]').off(c).on(c,function(){f.searchCallback()})}}})}if(f.linkage&&f.linkage.length>0){a.each(f.linkage,function(j,h){var k=h.length;h.sort(function(m,l){return m.level-l.level});a.each(h,function(m,l){if(a(f.queryDom+' [data-name="'+l.children.field+'"]').length>0){a(f.queryDom+' [data-name="'+l.children.field+'"]').off("open")}});var i="";var g="";a.each(h,function(n,m){if(a(f.queryDom+' [data-name="'+m.children.field+'"]').length==0||a(f.queryDom+' [data-name="'+m.children.field+'"]').length==0){return true}var l=function(){var r=[{label:"请选择...",value:""}];var q=a(f.queryDom+' [data-name="'+m.parent.field+'"]').val();if(q){var p={};if(m.extParam){p=m.extParam}p[m.parent.DM]=q;if(String(m.needAllParentParam)!="false"&&n>0){a.each(h,function(t,s){if(t<n){if(a(f.queryDom+' [data-name="'+s.parent.field+'"]').val()){p[s.parent.DM]=a(f.queryDom+' [data-name="'+s.parent.field+'"]').val()}}else{return false}})}var o=BH_UTILS.doSyncAjax(m.action.url,p);if(o.code=="0"&&o.datas[m.action.name].extParams.code==1){a.each(o.datas[m.action.name].rows,function(t,s){r.push({label:s[m.children.MC],value:s[m.children.DM]})})}else{a.bhTip({content:"请求出错",state:"danger"});return false}}a(f.queryDom+' [data-name="'+m.children.field+'"]').jqxDropDownList({source:r,selectedIndex:0});if(n<k-1){a.each(h,function(t,s){if(t>n){a(f.queryDom+' [data-name="'+s.children.field+'"]').jqxDropDownList({source:[{label:"请选择...",value:""}],selectedIndex:0})}})}if(String(m.autoSearch)!="false"){f.searchCallback()}};i=m.bindEventType?m.bindEventType:"close";g='[data-name="'+m.parent.field+'"]';if(m.bindType=="2"){a(f.queryDom).off(i,g).on(i,g,l)}else{a(f.queryDom+" "+g).off(i).on(i,l)}})})}},checkIgnoreFields:function(d,c){if(c.length<=0){return true}else{for(var b=0;b<c.length;b++){if(d==c[b]){return false}}return true}}})})(jQuery);(function(a){a.extend({getDicByZddmAsync:function(b){return this.getDicAsync({ZDDM:b,SFSY:"1"})},getDicAsync:function(b){return BH_UTILS.doAjax(WIS_EMAP_SERV.getContextPath()+"/sys/jwpubapp/modules/zdgl/ggzdcx.do",b)}})})(jQuery);(function(a){a.extend({multipleParentLinkage:function(c){var b={linkage:function(e){var d=this;if(!e.dom||!e.parent||!e.children||e.children.length==0){console.warn("缺少联动必传参数");return false}e.cLength=e.children.length;a.each(e.children,function(f,g){a(e.dom+' [data-name="'+g.colField+'"]').off("open")});a.each(e.parent,function(f,h){var g=function(){d.initLinkageAction(e,e.children[0],0)};if(!h.bindEventType){h.bindEventType="close"}if(h.bindType=="2"){if(!e.accumLateParentAction){a(e.dom).off(h.bindEventType,'[data-name="'+h.colField+'"]')}a(e.dom).on(h.bindEventType,'[data-name="'+h.colField+'"]',g)}else{if(!e.accumLateParentAction){a(e.dom+' [data-name="'+h.colField+'"]').off(h.bindEventType)}a(e.dom+' [data-name="'+h.colField+'"]').on(h.bindEventType,g)}});a.each(e.children,function(f,h){var g=function(){if(f==e.cLength-1){if(h.callBack){h.callBack()}}else{d.initLinkageAction(e,e.children[f+1],f+1)}};if(!h.bindEventType){h.bindEventType="close"}if(h.bindType=="2"){a(e.dom).off(h.bindEventType,'[data-name="'+h.colField+'"]').on(h.bindEventType,'[data-name="'+h.colField+'"]',g)}else{a(e.dom+' [data-name="'+h.colField+'"]').off(h.bindEventType).on(h.bindEventType,g)}});if(e.needClearData){a(e.dom).off("click",'[emap-role="FQ-clear-btn"]').on("click",'[emap-role="FQ-clear-btn"]',function(f){a(e.dom).emapFilterQuery("clear");a.each(e.children,function(h,i){var g=[];if(String(i.needPleaseChoose)!=="false"){g.push({label:"请选择...",value:""})}if(a(e.dom+' [data-name="'+i.colField+'"]').length>0){a(e.dom+' [data-name="'+i.colField+'"]').jqxDropDownList({source:g,selectedIndex:0})}})})}},initLinkageAction:function(g,p,f){if(a(g.dom+' [data-name="'+p.colField+'"]').length==0){if(p.callBack){p.callBack()}return false}var o=this;var l={};if(p.extParam){l=JSON.parse(JSON.stringify(p.extParam))}if(p.orderColumn){l["*order"]=p.orderColumn}else{l["*order"]="-"+p.modelName}var k=null;var j=null;var i=false;if(p.requiredParent){a.each(p.requiredParent,function(q,r){j=r;k=a(g.dom+' [data-name="'+r+'"]').val();if(p.otherParentName&&p.otherParentName[r]){j=p.otherParentName[r]}else{i=false;a.each(g.parent,function(t,s){if(r==s.colField){j=s.modelField;i=true;return false}});if(!i){a.each(g.children,function(t,s){if(t<f&&r==s.colField){j=s.modelField;return false}})}}if(!o.isEmpty(k)){l[j]=k}})}else{a.each(g.parent,function(q,r){j=r.modelField;k=a(g.dom+' [data-name="'+r.colField+'"]').val();if(p.otherParentName&&p.otherParentName[r.colField]){j=p.otherParentName[r.colField]}if(!o.isEmpty(k)){l[j]=k}});a.each(g.children,function(q,r){if(q<f){j=r.modelField;k=a(g.dom+' [data-name="'+r.colField+'"]').val();if(p.otherParentName&&p.otherParentName[r.colField]){j=p.otherParentName[r.colField]}if(!o.isEmpty(k)){l[j]=k}}else{return false}})}i=false;if(p.mustParent&&p.mustParent.length>0){a.each(p.mustParent,function(q,r){if(o.isEmpty(l[r])){i=true;return false}})}if(i){if(p.title){a.bhTip({content:p.title,state:"warning"})}else{console.warn("缺少联动必传参数")}a.each(g.children,function(r,s){if(r>=f){var q=[];if(String(s.needPleaseChoose)!=="false"){q.push({label:"请选择...",value:""})}if(a(g.dom+' [data-name="'+s.colField+'"]').length>0){a(g.dom+' [data-name="'+s.colField+'"]').jqxDropDownList({source:q,selectedIndex:0})}}})}else{var d=p.url;var h=p.action;if(p.action1Field&&!l[p.action1Field]){d=p.url1;h=p.action1}var n={param:JSON.stringify(l)};if(p.isAppAction==true){n=l}var e=BH_UTILS.doSyncAjax(d,n);if(e.code=="0"&&(!e.datas[h].extParams||e.datas[h].extParams&&e.datas[h].extParams.code==1)){var m=[];if(String(p.needPleaseChoose)!=="false"){m.push({label:"请选择...",value:""})}a.each(e.datas[h].rows,function(q,r){m.push({label:o.dealEmpty(r[p.modelName]),value:o.dealEmpty(r[p.modelField])})})}else{a.bhTip({content:"请求动作出错",state:"danger"});return false}a(g.dom+' [data-name="'+p.colField+'"]').jqxDropDownList({source:m,selectedIndex:0});a.each(g.children,function(r,s){if(r>f){var q=[];if(String(s.needPleaseChoose)!=="false"){q.push({label:"请选择...",value:""})}if(a(g.dom+' [data-name="'+s.colField+'"]').length>0){a(g.dom+' [data-name="'+s.colField+'"]').jqxDropDownList({source:q,selectedIndex:0})}}})}if(p.callBack){p.callBack()}},isEmpty:function(d){if(d===null||d===undefined||d===""){return true}return false},dealEmpty:function(d){if(d===null||d===undefined||d===""){return""}return d}};b.linkage(c)}})})(jQuery);(function(a){a.extend({autoLinkStuSearch:function(d,c,f,e){var b={doPrepareExtParams:function(g){if(!g){g={}}var h={XZNJ:"XZNJ",YXDM:"YXDM",ZYDM:"ZYDM",BJDM:"BJDM",ZYFXDM:"ZYFXDM",callBack:g.callBack};if(g&&g instanceof Object){a.each(h,function(i,j){if(g[i]){h[i]=g[i]}})}return h},doNjYxZyLink:function(g,k,i,h){var j=[{colField:k.ZYDM,modelField:"ZYDM",modelName:"ZYMC",isAppAction:true,url:window.WIS_CONFIG.ROOT_PATH+"/sys/jwpubapp/modules/xlld/ldcxzy.do",action:"ldcxzy",orderColumn:"+ZYDM",requiredParent:[k.XZNJ,k.YXDM],bindEventType:"close",callBack:k.callBack,bindType:1,needPleaseChoose:a(g+' [data-name="'+k.ZYDM+'"]').attr("xtype")=="select"}];if(i){j.push({colField:k.ZYFXDM,modelField:"ZYFXDM",modelName:"ZYFXMC",url:window.WIS_CONFIG.ROOT_PATH+"/sys/jwpubapp/modules/xlld/ldcxzyfx.do",action:"ldcxzyfx",isAppAction:true,otherParentName:{XZNJ:k.XZNJ,YXDM:k.YXDM,ZYDM:k.ZYDM},callBack:k.callBack,mustParent:["XZNJ","YXDM","ZYDM"],needPleaseChoose:a(g+' [data-name="'+k.ZYFXDM+'"]').attr("xtype")=="select"})}else{if(h){j.push({colField:k.BJDM,modelField:"BJDM",modelName:"BJMC",url:window.WIS_CONFIG.ROOT_PATH+"/sys/jwpubapp/modules/xlld/ldcxbj.do",action:"ldcxbj",isAppAction:true,otherParentName:{XZNJ:k.XZNJ,YXDM:k.YXDM},callBack:k.callBack,mustParent:["ZYDM"],needPleaseChoose:a(g+' [data-name="'+k.BJDM+'"]').attr("xtype")=="select"})}}a.multipleParentLinkage({dom:g,needClearData:true,parent:[{colField:k.XZNJ,modelField:"XZNJ",bindEventType:"close",bindType:1},{colField:k.YXDM,modelField:"YXDM",bindEventType:"close",bindType:1}],children:j})},doZyZyfxBjLink:function(g,j,i,h){a.multipleParentLinkage({dom:g,needClearData:true,accumLateParentAction:true,parent:[{colField:j.XZNJ,modelField:"XZNJ",bindEventType:"close",bindType:1},{colField:j.YXDM,modelField:"YXDM",bindEventType:"close",bindType:1},{colField:j.ZYDM,modelField:"ZYDM",bindEventType:"close",bindType:1},{colField:j.ZYFXDM,modelField:"ZYFXDM",bindEventType:"close",bindType:1}],children:[{colField:j.BJDM,modelField:"BJDM",modelName:"BJMC",url:window.WIS_CONFIG.ROOT_PATH+"/sys/jwpubapp/modules/xlld/ldcxbj.do",action:"ldcxbj",isAppAction:true,otherParentName:{XZNJ:j.XZNJ,YXDM:j.YXDM,ZYFXDM:j.ZYFXDM},callBack:j.callBack,mustParent:["ZYDM"],needPleaseChoose:a(g+' [data-name="'+j.BJDM+'"]').attr("xtype")=="select"}]})},build:function(h,g,j,i){var k=this.doPrepareExtParams(g);this.doNjYxZyLink(h,k,j,i);if(j&&i){this.doZyZyfxBjLink(h,k,j,i)}}};b.build(d,c,f,e)}})})(jQuery);(function(a){a.extend({publicExport:function(f){var m=this;var g=a(f.tableSelector).emapdatatable("checkedRecords");var d="[]";if(f.querySetting){d=f.querySetting}else{if(f.querySelector){if(f.searchType){d=a(f.querySelector)[f.searchType]("getValue")}else{d=a(f.querySelector).emapAdvancedQuery("getValue")}}}if(g.length>0){var p="";for(var j=0;j<g.length;j++){if(j==0){p=g[j].WID}else{p+=","+g[j].WID}}d='[{"name":"WID","value":"'+p+'","linkOpt":"and","builder":"m_value_equal"}]'}var n=a(f.tableSelector).emapdatatable("getVisibleColumns");var e=[];var k=[];a.each(n,function(i,q){if(q.datafield&&q.datafield!="field_checkbox"){e.push(q.datafield.split("_")[0]);k.push(q.text)}});if(f.dealFieldCode&&f.dealFieldCode instanceof Function){e=f.dealFieldCode(e)}var o=f.totalSize;if(f.url){var h=BH_UTILS.doSyncAjax(f.url,{querySetting:d,pageSize:1,pageNumber:1});o=h.datas[f.action].totalSize}var b=window.WIS_CONFIG.ROOT_PATH+"/sys/jwpubapp/export/excel.do";var l={action:f.action,captions:k.join(","),colnames:e.join(","),filename:f.fileName,appName:f.appName};if(f.orderColumn){l.orderColumn=f.orderColumn}if(f.dealBeanId){l.dealBeanId=f.dealBeanId}if(d.length>0){l.querySetting=d}if(f.jsonData&&JSON.stringify(f.jsonData).length>4){l.param=JSON.stringify(f.jsonData)}if(o!=null){l.totalSize=o}b=encodeURI(b);var c="jqueryExportExcel";m.excelForm(l,b,c)},publicExportWithFields:function(g){var i=this;var c=g.totalSize;if(g.url){var f=BH_UTILS.doSyncAjax(g.url,{querySetting:JSON.stringify(g.querySetting),pageSize:1,pageNumber:1});c=f.datas[g.action].totalSize}var e=window.WIS_CONFIG.ROOT_PATH+"/sys/jwpubapp/export/excel.do";var d={action:g.action,captions:g.fieldName.join(","),colnames:g.fieldCode.join(","),filename:g.fileName,appName:g.appName};if(g.dealBeanId){d.dealBeanId=g.dealBeanId}if(g.orderColumn){d.orderColumn=g.orderColumn}if(g.querySetting.length>0){d.querySetting=JSON.stringify(g.querySetting)}var b=g.jsonData;if(b&&JSON.stringify(b).length>4){d.param=JSON.stringify(b)}if(c!=null){d.totalSize=c}e=encodeURI(e);var h="jqueryExportExcel";i.excelForm(d,e,h)},publicDatatableWithExport:function(d){var h=this;if(!d.action||!d.extraParam||!d.extraParam.tableDom){console.log("缺少必传字段！");return}var g={searchType:"emapAdvancedQuery",showSearchKey:false,showTotalNum:true,hasExport:true,hasZdyl:true};var e=d.extraParam;e=a.extend({},g,e);var i={fastRender:true,sortable:true,params:{}};if(!d.pageSizeOptions&&window.emapdatatableDefaultPageSize){var k=parseInt(window.emapdatatableDefaultPageSize);i.pageSize=k;if(k<=20){i.pageSizeOptions=[k,k*2,k*5,k*10]}else{if(k<=40){i.pageSizeOptions=[k,k*2,k*5]}else{if(k<=100){i.pageSizeOptions=[k,k*2]}else{i.pageSizeOptions=[k]}}}}if(window.emapdatatableDefaultHeight!="normal"&&d.height!="normal"){i.height=window.emapdatatableDefaultHeight;if(!i.height){i.height=null}}if(d.height=="normal"){delete d.height}var c=a.extend(true,{},i,d);delete c.extraParam;if(c.customColumns){a.each(c.customColumns,function(l,m){if(m.column){if(!m.column.pinned&&String(m.column.pinned)!="false"){m.column.pinned=true}}else{m.pinned=true}})}var f="";if(e.hasExport){if(e.buttonDom){f+='<a href="javascript:void(0)" class="bh-btn bh-btn-default '+c.action+'-export" data-disabled="0">导出</a>'}else{f+='<div class="bh-pull-left bh-mb-8"><a href="javascript:void(0)" class="bh-btn bh-btn-default '+c.action+'-export" data-disabled="0">导出</a></div>'}}if(e.importQueryParam){var b=c.action+"-importQueryBtn";e.importQueryParam=a.extend({},e.importQueryParam,{tableDom:e.tableDom,btnDom:"."+b});f+='<button type="button" class="'+b+' bh-btn bh-btn-default"><i class="iconfont icon-search"></i><span class="value">导入查询</span></button>';if(c.params){c.params.importQueryBs=e.tableDom}}if(e.hasZdyl){f+='<div class="bh-pull-right bh-mb-8" style="margin: 5px 0;"><span class="bh-switch-item bh-switch-setting '+c.action+'-zdyl" style="margin-right: 8px;cursor: pointer;"><i class="iconfont icon-zidingyixianshilie"></i><span>自定义列</span></span></div>'}if(e.buttonDom){a(e.buttonDom).append(f)}else{f+='<div class="bh-clearfix"></div>';a(e.tableDom).before(f)}if(e.queryDom){var j=e.searchOption?e.searchOption:{};if(!j.data){j.data=WIS_EMAP_SERV.getModel((e.searchPagePath?e.searchPagePath:d.pagePath),(e.searchAction?e.searchAction:d.action),"search");j.data.controls=j.data.controls.filter(function(l){return !l["search.hidden"]})}if(e.searchType=="emapFilterQuery"){j.showBlankOption=false;if(!j.onSearch){j.onSearch=function(m){if(e.hasIntervalTime){if(window.isIntervalTime){a.bhTip({content:"正在请求中，请稍后再试！",state:"warning"});return false}else{window.isIntervalTime=true;setTimeout(function(){window.isIntervalTime=false},1000)}}if(e.beforeSearch&&e.beforeSearch instanceof Function){if(!e.beforeSearch()){return false}}var l={};if(e.getSearchCallBackParam){l=e.getSearchCallBackParam(m)}if(!l.querySetting){l.querySetting=a(e.queryDom).emapFilterQuery("getValue")}if(l!=false){a(e.tableDom).emapdatatable("reloadFirstPage",l)}}}a(e.queryDom).emapFilterQuery(j);if(!e.showSearchKey){a(e.queryDom).find('[data-field="_commonFilter"]').hide()}}else{if(!j.showTotalNum&&String(j.showTotalNum)!="false"){j.showTotalNum=e.showTotalNum}a(e.queryDom).emapAdvancedQuery(j);a(e.queryDom).on("search",function(o,n,m){if(e.hasIntervalTime){if(window.isIntervalTime){a.bhTip({content:"正在请求中，请稍后再试！",state:"warning"});return false}else{window.isIntervalTime=true;setTimeout(function(){window.isIntervalTime=false},1000)}}if(e.beforeSearch&&e.beforeSearch instanceof Function){if(!e.beforeSearch()){return false}}var l={};if(e.getSearchCallBackParam){l=e.getSearchCallBackParam(o,n,m)}if(!l.querySetting){l.querySetting=n}a(e.tableDom).emapdatatable("reloadFirstPage",l)});if(e.showTotalNum&&!c.searchElement){c.searchElement=a(e.queryDom)}}}a(e.tableDom).emapdatatable(c);if(e.hasZdyl){a("."+c.action+"-zdyl").on("click",function(){a(e.tableDom).emapdatatable("selectToShowColumns")})}if(e.hasExport){if(e.exportType=="APP"){a("."+c.action+"-export").on("click",function(p){var l=a(p.currentTarget);if(l.attr("data-disabled")=="1"){a.bhTip({content:"操作太频繁啦！请10s后再试。",state:"warning"});return false}l.attr("data-disabled","1");if(e.beforeSearch&&e.beforeSearch instanceof Function){if(!e.beforeSearch()){l.attr("data-disabled","0");return false}}var o="[]";if(e.querySetting){if(e.querySetting instanceof Function){o=e.querySetting()}else{o=e.querySetting}}var n=c.params;var m=[];if(e.getJsonData){m=e.getJsonData()}if(m&&JSON.stringify(m).length>4){n=JSON.stringify(m)}a.publicExportFn({tableSelector:e.tableDom,querySelector:e.queryDom,querySetting:o,params:n,action:c.action,fileName:e.fileName,appName:e.appName,pageName:e.pageName,tableKey:e.tableKey,queryType:e.searchType,isGrid:false});setTimeout(function(){l.attr("data-disabled","0")},10000)})}else{a("."+c.action+"-export").on("click",function(t){var z=a(t.currentTarget);if(z.attr("data-disabled")=="1"){a.bhTip({content:"操作太频繁啦！请10s后再试。",state:"warning"});return false}z.attr("data-disabled","1");if(e.beforeSearch&&e.beforeSearch instanceof Function){if(!e.beforeSearch()){z.attr("data-disabled","0");return false}}var n="[]";if(e.querySetting){if(e.querySetting instanceof Function){n=e.querySetting()}else{n=e.querySetting}}else{if(e.queryDom){if(e.searchType=="emapFilterQuery"){n=a(e.queryDom).emapFilterQuery("getValue")}else{n=a(e.queryDom).emapAdvancedQuery("getValue")}}}var o=a(e.tableDom).emapdatatable("checkedRecords");if(o.length>0){var y="";for(var q=0;q<o.length;q++){if(q==0){y=o[q].WID}else{y+=","+o[q].WID}}n='[{"name":"WID","value":"'+y+'","linkOpt":"and","builder":"m_value_equal"}]'}var s=[];if(e.getJsonData){s=e.getJsonData()}var w=[];var x=[];if(e.fieldName&&e.fieldCode){x=e.fieldCode;w=e.fieldName}else{var u=a(e.tableDom).emapdatatable("getVisibleColumns");a.each(u,function(A,B){if(B.datafield&&B.datafield!="field_checkbox"){x.push(B.datafield.split("_")[0]);w.push(B.text)}})}if(e.dealFieldCode&&e.dealFieldCode instanceof Function){x=e.dealFieldCode(x)}var v=e.totalSize;if(e.url){var p=BH_UTILS.doSyncAjax(e.url,{querySetting:n,pageSize:1,pageNumber:1});v=p.datas[c.action].totalSize}var l=window.WIS_CONFIG.ROOT_PATH+"/sys/jwpubapp/export/excel.do";var r={action:c.action,captions:w.join(","),colnames:x.join(","),filename:e.fileName,appName:e.appName};if(e.dealBeanId){r.dealBeanId=e.dealBeanId}if(e.orderColumn){r.orderColumn=e.orderColumn}if(n.length>2){r.querySetting=n}if(s&&JSON.stringify(s).length>4){r.param=JSON.stringify(s)}if(v!=null){r.totalSize=v}l=encodeURI(l);var m=c.action+"jqueryExportExcel";h.excelForm(r,l,m);setTimeout(function(){z.attr("data-disabled","0")},30000)})}}if(e.importQueryParam){a.initImportQueryBtn(e.importQueryParam)}},excelForm:function(f,b,g){var e=document.createElement("form");e.action=b;e.target="_blank";e.method="post";e.style.display="none";e.id=g;for(var d in f){var c=document.createElement("input");c.name=d;c.value=f[d];e.appendChild(c)}document.body.appendChild(e);e.submit();a("#"+g).remove()},initEmapExport:function(c,b){var f={};b.drbs=a(c).selector;if(c){if(a(c).attr("emap-role")!="datatable"){c=a(c).find(".bh-grid-table")}if(b&&!b.colnames){var j=[];var e=a(c).jqxDataTable("_columns");if(e&&e.length>0){for(var h=0;h<e.length;h++){if(e[h].hidden||!e[h].datafield||e[h].datafield=="field_checkbox"){continue}var d=e[h].datafield.replace("_DISPLAY","");j.push(d)}}if(j.length<1){a.alert(a.i18N("ggglmk.select_export_columns|请选择导出列"));return}f.colnames=j.join()}if(b&&!b.order){var g=a(c).emapdatatable("getSort");if(g){g=g.exp.replace("_DISPLAY","");f["*order"]=g;f.order=g}}}b=a.extend(f,b);var k="../../emapcomponent/imexport/export.do";require("./utils").doAjax(k,b,"POST").done(function(i){if(i&&i.attachment){location.href="../../emapcomponent/file/getAttachmentFile/"+i.attachment+".do"}return false})},publicExportFn:function(e){if(!window.location.origin){window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}var c={app:e.appName,contextPath:window.location.origin+WIS_CONFIG.PATH,module:e.module||"modules",page:e.pageName,action:e.action,containerId:e.tableSelector,filename:e.fileName};if(e.analyse){c.analyse=e.analyse}if(e.write){c.write=e.write}var d="[]";if(e.querySelector){if(e.queryType=="emapFilter"||e.queryType=="emapFilterQuery"){d=a(e.querySelector).emapFilterQuery("getValue")}else{d=a(e.querySelector).emapAdvancedQuery("getValue")}}d=JSON.parse(d);if(e.querySetting){var f=JSON.parse(e.querySetting);a.each(f,function(n,o){d.push(o)})}if(e.params){c=a.extend(c,e.params)}var l=a(e.tableSelector);if(e.isGrid){c.isGrid=e.isGrid;l=a(e.tableSelector).emapGrid("getTable")}var i=l.emapdatatable("checkedRecords");var k=e.tableKey?e.tableKey:"WID";var m="";a.each(i,function(n,o){m+=o[k]+","});if(i.length>0){d.push({caption:"",name:k,value:m.slice(0,-1),builder:"m_value_equal",linkOpt:"AND"})}if(d){c.querySetting=JSON.stringify(d)}c.order=e.order;var b=50000;if(e.limitNum){b=e.limitNum}var j={querySetting:c.querySetting,pageSize:1,pageNumber:1};if(e.params){j=a.extend(j,e.params)}var g=BH_UTILS.doSyncAjax(WIS_EMAP_SERV.getAbsPath(c.module+"/"+e.pageName+"/"+e.action+".do"),j);var h=g.datas[e.action].totalSize;if(h>b){a.bhTip({content:"导出数据超过最大限制"+b+"条",state:"warning"});return false}this.exportForApp(c)},exportForApp:function(f){var d=a(f.containerId);if(f.isGrid){d=a(f.containerId).emapGrid("getTable")}var h=f;h.module=f.module?f.module:"*default";if(!f.colnames){var c=d.emapdatatable("getVisibleColumns");var b="";for(var e=0;e<c.length;e++){if(c[e].datafield&&c[e].datafield!="field_checkbox"){b+=c[e].datafield.replace("_DISPLAY","")+","}}h.colnames=b.substr(0,b.length-1)}if(!f.order){var g=d.emapdatatable("getSort");if(g&&g.exp){h["*order"]=g.exp.replace("_DISPLAY","")}}else{h["*order"]=f.order}this.doAppExport(h,f)},publicExportAction:function(e,c,b){var d={app:e.appName,contextPath:window.location.origin+WIS_CONFIG.PATH,module:"modules",page:e.pageName,action:e.action,filename:e.fileName};if(e.params){d=a.extend(d,e.params)}var e=d;e.module=d.module?d.module:"*default";if(c){e.colnames=c}if(b){e["*order"]=b}this.doAppExport(e,d)},doAppExport:function(d,c){var b=c.contextPath+"/sys/emapcomponent/imexport/export.do";jQuery.ajax({url:b,data:d,type:"post",dataType:"json",cache:false,success:function(f){var g=f.attachment;var e=c.contextPath+"/sys/emapcomponent/file/getAttachmentFile/"+g+".do";window.location.href=e;return false},error:function(e){if(e.status==401){window.location.reload()}else{if(e.status==403){BH_UTILS.bhDialogWarning({title:"提示",content:"当前角色权限不足，请切换角色后重新操作",buttons:[{text:"确认",className:"bh-btn-warning",callback:function(){}}]});return false}}if(e.statusText.indexOf("NetworkError")>-1){BH_UTILS.bhDialogDanger({title:"网络错误",content:"您可以尝试刷新页面解决该问题",buttons:[{text:"关闭",className:"bh-btn-default"}]});return false}}})},publicExportForBigData:function(e){if(!e){console.error("导出传参不可为空");return false}var g=JSON.parse(JSON.stringify(e));delete g.querySelector;delete g.tableSelector;delete g.searchType;if(!g.param){g.param={}}var c="[]";var f=[];if(e.selectRecords){f=e.selectRecords}else{if(e.tableSelector){f=a(e.tableSelector).emapdatatable("checkedRecords")}}if(f.length>0){var m="";for(var h=0;h<f.length;h++){if(h==0){m=f[h].WID}else{m+=","+f[h].WID}}c='[{"name":"WID","value":"'+m+'","linkOpt":"and","builder":"m_value_equal"}]'}else{if(g.param.querySetting){c=g.param.querySetting}else{if(e.querySelector){if(e.searchType){c=a(e.querySelector)[e.searchType]("getValue")}else{c=a(e.querySelector).emapAdvancedQuery("getValue")}}}}g.param.querySetting=c;g.param=JSON.stringify(g.param);if(!g.captions||!g.colnames){var d=[];var k=[];var l=a(e.tableSelector).emapdatatable("getVisibleColumns");a.each(l,function(i,n){if(n.datafield&&n.datafield!="field_checkbox"){d.push(n.datafield.split("_")[0]);k.push(n.text)}});if(e.dealFieldCode&&e.dealFieldCode instanceof Function){d=e.dealFieldCode(d)}g.captions=k.join(",");g.colnames=d.join(",")}if(e.orderColumn){orderColumn="&orderColumn="+e.orderColumn;g.orderColumn=e.orderColumn}var j=window.locationHash?window.locationHash:("/"+window.appname);g.menu=j.split("/")[1];var b=window.context_path+"/sys/jwpubapp/export/generateAttachment.do";jQuery.ajax({url:b,data:g,type:"post",dataType:"json",cache:false,success:function(i){if(i.code=="1"){a.bhTip({content:"正在生成文件，请稍后在 导出记录 中查看！",state:"success"})}else{a.bhTip({content:"生成文件失败！",state:"danger"})}return false},error:function(i){}})}})})(jQuery);(function(a){a.extend({publicHeadLinkage:function(e){if(!e.dom||!e.linkage){console.error("publicHeadLinkage：缺少必要参数");return false}var h=function(i){if(i===null||i===undefined||i===""){return""}return i};var g=function(i){if(i===null||i===undefined||i===""){return true}return false};var c=function(){var l=[];var j="0123456789abcdef";for(var k=0;k<36;k++){l[k]=j.substr(Math.floor(Math.random()*16),1)}l[14]="4";l[19]=j.substr((l[19]&3)|8,1);l[8]=l[13]=l[18]=l[23]="";return l.join("")};if(!e.key){e.key=c()}e.linkageLength=e.linkage.length;var b={};var f=function(){var i='<div class="'+e.key+'-head-linkage head-linkage" style="margin-left: 20px;color: #bbb;display: inline-block; font-size: 12px;font-weight: normal;">';a.each(e.linkage,function(m,p){if(p.defaultParam.DMValue){b[p.fieldCode]={DM:p.defaultParam.DMValue,MC:p.defaultParam.MCValue}}else{var q={};if(p.defaultParam.queryParam){q=p.defaultParam.queryParam}else{if(p.requiredParent){a.each(p.requiredParent,function(s,r){if(p.otherParentName[r]){q[p.otherParentName[r]]=b[r].DM}})}else{a.each(e.linkage,function(s,r){if(r.level<p.level){if(p.otherParentName[r.fieldCode]){q[p.otherParentName[r.fieldCode]]=b[r.fieldCode].DM}}})}}q=a.extend({},q,p.extParam);if(p.mustParent){var k=true;a.each(p.mustParent,function(r,s){if(g(q[s])){k=false;return false}});if(!k){if(p.title){a.bhTip({content:p.title,state:"warning"})}else{console.warn("缺少联动必传参数")}return false}}var o={};if(e.searchParamType=="1"){o=q}else{o={param:JSON.stringify(q)}}var j={url:p.defaultParam.url?p.defaultParam.url:p.children.url,action:p.defaultParam.action?p.defaultParam.action:p.children.action,DM:p.defaultParam.DM?p.defaultParam.DM:p.children.DM,MC:p.defaultParam.MC?p.defaultParam.MC:p.children.MC};var l=BH_UTILS.doSyncAjax(j.url,o);if(l.code=="0"){if(!p.defaultParam.selectedIndex){p.defaultParam.selectedIndex=0}var n=l.datas[j.action].rows[p.defaultParam.selectedIndex];if(n){b[p.fieldCode]={DM:n[j.DM],MC:n[j.MC]}}else{a.bhTip({content:"未获取到合适的"+p.fieldName,state:"danger"});return false}}else{a.bhTip({content:"请求动作出错",state:"danger"});return false}}i+='<span class="head-linkage-item" data-field="'+p.fieldCode+'" data-dm="'+h(b[p.fieldCode].DM)+'"> '+h(b[p.fieldCode].MC)+"</span>/"});i=i.substring(0,i.length-1);i+='<a class="'+e.key+'-head-a-adjust" style="padding-left: 10px;cursor: pointer;">更改</a>';i+="</div>";a(e.dom).append(i);if(e.initCallback){e.initCallback()}};f();var d=function(){var j='<div class="'+e.key+'-head-select-group" style="padding-top: 30px;">';a.each(e.linkage,function(o,p){j+='<div class="head-select-item" style="margin-bottom: 20px;"><div class="bh-advancedQuery-groupName name_left" style="width: 20%;">'+p.fieldName+'：</div><div class="bh-advancedQuery-groupList bh-label-radio-group"><div class="dropdowm-list" data-fieldname="'+p.fieldName+'" data-name="'+p.fieldCode+'"></div></div></div>'});j+="</div>";BH_UTILS.bhWindow(j,e.title,[{text:"确定",className:"bh-btn-primary",callback:function(){k();j='<div class="'+e.key+'-head-linkage head-linkage" style="margin-left: 20px;color: #bbb;display: inline-block; font-size: 12px;font-weight: normal;">';var o=true;a.each(e.linkage,function(p,q){if(String(q.require)!="false"&&(!b[q.fieldCode]||!b[q.fieldCode].DM)){a.bhTip({content:"请选择"+q.fieldName,state:"warning"});o=false;return false}j+='<span class="head-linkage-item" data-field="'+q.fieldCode+'" data-dm="'+h(b[q.fieldCode].DM)+'"> '+h(b[q.fieldCode].MC)+"</span>/"});if(o){j=j.substring(0,j.length-1);j+='<a class="'+e.key+'-head-a-adjust" style="padding-left: 10px;cursor: pointer;">更改</a>';j+="</div>";a("."+e.key+"-head-linkage").replaceWith(j);if(e.changeCallback){e.changeCallback()}else{if(e.initCallback){e.initCallback()}}}else{return false}}},{text:"取消",className:"bh-btn-default",callback:function(){}}],{height:300,width:500});b={};var i=function(){b={};var o=null;a.each(a("."+e.key+"-head-linkage").find(".head-linkage-item"),function(p,q){o=a(q);b[o.attr("data-field")]={DM:o.attr("data-dm"),MC:o.text()}})};i();var k=function(p){b={};var o=null;a.each(a("."+e.key+"-head-select-group").find(".dropdowm-list"),function(r,q){o=a(q).jqxDropDownList("getSelectedItem");if(o){b[a(q).attr("data-name")]={DM:o.value,MC:o.label}}if(p&&a(q).attr("data-name")==p){return false}})};var l=function(o){a.each(e.linkage,function(q,p){if(p.level>=o){sourceArr=[];if(String(p.needPleaseChoose)!=="false"){sourceArr.push({label:"请选择...",value:""})}if(a("."+e.key+'-head-select-group [data-name="'+p.fieldCode+'"]').length>0){a("."+e.key+'-head-select-group [data-name="'+p.fieldCode+'"]').jqxDropDownList({source:sourceArr,selectedIndex:0})}}})};var n=function(w,s){var q={};if(w.requiredParent){a.each(w.requiredParent,function(y,x){if(w.otherParentName[x]){q[w.otherParentName[x]]=b[x].DM}})}else{a.each(e.linkage,function(y,x){if(x.level<w.level){if(w.otherParentName[x.fieldCode]){q[w.otherParentName[x.fieldCode]]=b[x.fieldCode].DM}}})}q=a.extend({},q,w.extParam);if(w.mustParent){var p=true;a.each(w.mustParent,function(x,y){if(g(q[y])){p=false;return false}});if(!p){if(w.title){a.bhTip({content:obj.title,state:"warning"})}else{console.warn("缺少联动必传参数")}l(w.level);return false}}var u={};if(e.searchParamType=="1"){u=q}else{u={param:JSON.stringify(q)}}var t={url:w.children.url,action:w.children.action,DM:w.children.DM,MC:w.children.MC};var o=BH_UTILS.doSyncAjax(t.url,u);if(o.code=="0"){var r=-1;var v=[];a.each(o.datas[t.action].rows,function(x,y){v.push({label:h(y[t.MC]),value:h(y[t.DM])});if(s&&y[t.DM]==b[w.fieldCode].DM){r=x}});if(String(w.needPleaseChoose)!=="false"){v.unshift({label:"请选择...",value:""});r++}if(r==-1){r=0}if(s){a("."+e.key+'-head-select-group [data-name="'+w.fieldCode+'"]').jqxDropDownList({source:v,selectedIndex:r,placeHolder:"请选择...",filterable:true,filterPlaceHolder:"搜索",searchMode:"contains"})}else{a("."+e.key+'-head-select-group [data-name="'+w.fieldCode+'"]').jqxDropDownList({source:v,selectedIndex:r});l(w.level+1)}}else{a.bhTip({content:"请求动作出错",state:"danger"});return false}};a.each(e.linkage,function(o,p){n(p,true)});if(!e.bindEventType){e.bindEventType="close"}var m=function(p){var o=a(p.currentTarget).attr("data-name");a.each(e.linkage,function(q,r){if(o==r.fieldCode&&q<e.linkageLength-1){k(o);n(e.linkage[q+1],false)}})};if(e.bindType=="2"){a("."+e.key+"-head-select-group").off(e.bindEventType,".dropdowm-list").on(e.bindEventType,".dropdowm-list",m)}else{a("."+e.key+"-head-select-group .dropdowm-list").off(e.bindEventType).on(e.bindEventType,m)}};a("body").off("click","."+e.key+"-head-a-adjust").on("click","."+e.key+"-head-a-adjust",function(i){d()})},getHeadLinkage:function(e,f){if(!e){console.error("getHeadLinkage：传参缺少唯一标识key");return null}var c=a("."+e+"-head-linkage");if(!c||c.length==0){console.error("元素不存在");return null}var b={};var g=[];if(f){g=JSON.parse(f)}var d=null;a.each(c.find(".head-linkage-item"),function(h,i){d=a(i);if(d.attr("data-dm")){b[d.attr("data-field")]=d.attr("data-dm");g.push({name:d.attr("data-field"),value:d.attr("data-dm"),builder:"m_value_equal",linkOpt:"and"})}});b.querySetting=JSON.stringify(g);return b}})})(jQuery);$(function(){window.publicFrreportant1={getReportData:function(){var a=this;var b={SFQY:"1",APP:window.WIS_CONFIG.APPID};$.ajax({url:window.WIS_CONFIG.ROOT_PATH+"/sys/jwpubapp/modules/bb/cxjwggbbdqx.do",data:b,type:"post",success:function(e){if(e.code=="0"&&e.datas.cxjwggbbdqx.extParams.code==1){if(e.datas.cxjwggbbdqx.rows.length>0){$.each(e.datas.cxjwggbbdqx.rows,function(f,g){g.container=g.YLCS;g.valueString=JSON.stringify(g)});var d=[];var c=true;$.each(e.datas.cxjwggbbdqx.rows,function(f,g){c=true;$.each(d,function(i,h){if(g.container==h.container){h.bblist.push(g);c=false}});if(c){d.push({container:g.container,bblist:[g]})}});a.bindDomEvent(d)}}else{console.warn("查询报表信息失败"+(e.datas?(":"+e.datas.cxjwggbbdqx.extParams.msg):""))}}})},bindDomEvent:function(c){var a=this;a.initFlag=false;var b=function(){a.initFlag=false;setTimeout(function(){if(!a.initFlag){a.initReport(c);a.initFlag=true}},2000)};document.body.removeEventListener("DOMNodeInserted",b);document.body.addEventListener("DOMNodeInserted",b)},bindReportClickEvent:function(a){var b=this;a.off("click",".reportClick").on("click",".reportClick",function(h){var g=JSON.parse($(h.currentTarget).attr("data-value"));var i={};if(g.GDDZ){i.reportlet=g.GDDZ}else{i.reportlet=g.PID+"/"+g.ID+".cpt"}var d=[];var e=[];var f=false;var c=false;if(g.CSLX.indexOf("01")>-1||g.CSLX.indexOf("02")>-1){f=true}if(g.CSLX.indexOf("03")>-1){c=true}if((f&&!g.GDCS)||(c&&!g.QJCS)){$.bhTip({content:"缺少选择器参数",state:"warning"});return false}switch(g.DTCS){case"01":if(f){d=$(g.GDCS).emapdatatable("checkedRecords")}if(c){e=JSON.parse($(g.QJCS).emapAdvancedQuery("getValue"))}break;case"02":if(f){d=$(g.GDCS).emapdatatable("checkedRecords")}if(c){e=JSON.parse($(g.QJCS).emapFilterQuery("getValue"))}break;case"03":if(f){d.push($(g.GDCS).emapform("getValue"))}if(c){e=JSON.parse($(g.QJCS).emapAdvancedQuery("getValue"))}break;case"04":if(f){d=$(g.GDCS).emapGrid("getTable").emapdatatable("checkedRecords")}if(c){e=JSON.parse($(g.QJCS).emapAdvancedQuery("getValue"))}break;case"05":if(f){d=$(g.GDCS).emapGrid("getTable").emapdatatable("checkedRecords")}if(c){e=JSON.parse($(g.QJCS).emapFilterQuery("getValue"))}break;default:if(f){d=$(g.GDCS).emapdatatable("checkedRecords")}if(c){e=JSON.parse($(g.QJCS).emapAdvancedQuery("getValue"))}break}if(!c&&g.CSLX.indexOf("01")>-1&&d.length!=1){$.bhTip({content:"请勾选一条数据",state:"warning"});return false}if(!c&&g.CSLX.indexOf("02")>-1&&d.length==0){$.bhTip({content:"请勾选数据",state:"warning"});return false}$.ajax({url:window.WIS_CONFIG.ROOT_PATH+"/sys/jwpubapp/modules/bb/cxjwggbbcs.do",data:{BBWID:g.WID,SFSY:"1"},type:"post",success:function(l){var j="";var k=true;$.each(l.datas.cxjwggbbcs.rows,function(m,n){j="";if(n.CSZ){j=n.CSZ}else{if(n.XZQ){j=$(n.XZQ).attr("data-dm")}else{if(d.length>0){$.each(d,function(p,o){if(o[n.MXCSM]){j+=o[n.MXCSM]+","}});if(j.length>0){j=j.substring(0,j.length-1)}}else{$.each(e,function(p,o){if(Object.prototype.toString.call(o)=="[object Array]"){$.each(o,function(r,q){if(q.name==n.MXCSM){j=q.value;return false}})}else{if(o.name==n.MXCSM){j=o.value;return false}}})}}}if(String(j)==="undefined"||String(j)==="null"){j=""}if(n.SFBC==1&&j==""){$.bhTip({content:"请选择"+n.CSM+"参数",state:"warning"});k=false;return false}i[n.CSM]=j});if(k){b.openReport(i,g)}}})})},openReport:function(b,a){b.BBWID=a.WID;if(a.YMYS=="01"){$.bhPaperPileDialog.show({content:'<article bh-layout-role="single"><h2>'+a.TITLE+'</h2><section><iframe width="100%" height="800px" frameborder="no" src=""></iframe></section></article>',render:function(){var e="";for(var d in b){e+="&"+d+"="+encodeURI(encodeURI(b[d]))}e=e.replace(/&/,"?");var c=WIS_EMAP_SERV.getContextPath()+"/sys/frReport2/show.do"+e;$("iframe").attr("src",c)}})}},initReport:function(d,e){var a=this;var b=window.location.hash.split("/")[1];if(!b){if(!e){setTimeout(function(){a.initReport(d,true)},1000)}else{console.warn("获取不到location.hash中的模块名");return false}}var c=null;$.each(d,function(g,i){c=[];$.each(i.bblist,function(k,j){if(j.PAGE==b){c.push(j)}});if(c.length==0){return true}var f=$(i.container);if(f.length>1){$.bhTip({content:"报表父元素不唯一，请重新配置",state:"warning"})}else{if(f.length==1&&f.find(".public-frreport").length==0){var h='<div class="bh-l-inline public-frreport">';if(c.length==1){h+="<button class='bh-btn bh-btn-default bh-btn-larger reportClick' data-value='"+c[0].valueString+"'>"+c[0].TITLE+"</button>"}else{h+='<div class="bh-dropdown bh-ml-4 bh-l-inline" bh-dropdown-role="bhDropdown"><button class="bh-btn bh-btn-default bh-btn-larger" type="button" bh-dropdown-role="bhDropdownBtn">打印报表</button><ul class="bh-dropdown-menu" bh-dropdown-role="bhDropdownMenu"> ';$.each(c,function(k,j){h+="<li class='reportClick' data-value='"+j.valueString+"'><a href='javascript:void(0)'>"+j.TITLE+"</a></li>"});h+="</ul></div>"}h+="</div>";f.append(h);a.bindReportClickEvent(f)}}})}};setTimeout(function(){window.publicFrreportant1.getReportData()},100)});(function(a){a.extend({openImportQueryDialog:function(b){if(!b.cols){a.err("未获取到导入查询配置信息");return}var c="com.wisedu.emap.jwpubapp.widget.importQuery.JwImportQueryAnalyse";var d={analyse:c,save:c,DRBS:b.tableDom,COLS:b.cols,colnames:b.cols,APPNAME:WIS_CONFIG.APPNAME,filename:"导入查询"};a.emapImport({contextPath:WIS_CONFIG.PATH,app:WIS_CONFIG.APPNAME,module:"modules",page:b.page,action:b.action,params:d,importCallback:function(f,g){if(f){a(".emap-import-result-detail").hide();if(f!=0){var e=a(b.btnDom);e.addClass("deleteImportQuery");e.find(".value").length>0?e.find(".value").text("关闭导入查询"):e.html("关闭导入查询")}}},closeCallback:function(){if(b.callback&&typeof(b.callback)=="function"){b.callback()}},preCallback:function(){a(".emap-import-content").css("margin-top","0px")}})},initImportQueryBtn:function(c){if(!c.tableDom||!c.btnDom){console.error("导入查询缺少必传参数");return}var e={APPNAME:WIS_CONFIG.APPNAME,DRBS:c.tableDom};var d=a(c.btnDom);var b=contextPath+"/sys/jwpubapp/jw_import_query/queryImportQueryBtn.do";BH_UTILS.doAjax(b,{param:JSON.stringify(e)}).done(function(f){if(f.code=="0"&&f.datas.queryImportQueryBtn.extParams.code==1){if(f.datas.queryImportQueryBtn.rows.length>0){d.addClass("deleteImportQuery");d.find(".value").length>0?d.find(".value").text("关闭导入查询"):d.html("关闭导入查询");c.cols=f.datas.queryImportQueryBtn.rows[0].PPZD}else{d.removeClass("deleteImportQuery");d.find(".value").length>0?d.find(".value").text("导入查询"):d.html("导入查询")}if(c.callback&&typeof(c.callback)=="function"){c.callback()}}else{a.bhTip({content:f.datas?f.datas.queryImportQueryBtn.extParam.msg:"查询导入查询参数失败",state:"danger"})}});d.off().on("click",function(){if(d.hasClass("deleteImportQuery")){a.removeImportQueryResult(c)}else{a.openImportQueryDialog(c)}})},removeImportQueryResult:function(b){if(!b.tableDom||!b.btnDom){console.error("导入查询缺少必传参数");return}BH_UTILS.bhDialogWarning({title:"提醒",content:"关闭后恢复默认，确定关闭吗？",buttons:[{text:"确定",callback:function(){var d={APPNAME:WIS_CONFIG.APPNAME,DRBS:b.tableDom};var c=contextPath+"/sys/jwpubapp/jw_import_query/removeImportResults.do";BH_UTILS.doAjax(c,{param:JSON.stringify(d)}).done(function(f){if(f.code=="0"&&f.datas.removeImportResults.extParams.code==1){var e=a(b.btnDom);e.removeClass("deleteImportQuery");e.find(".value").length>0?e.find(".value").text("导入查询"):e.html("导入查询");a.bhTip({content:"关闭导入查询成功",state:"success"});if(b.callback&&typeof(b.callback)=="function"){b.callback()}}else{a.bhTip({content:f.datas?f.datas.queryImportQueryBtn.extParam.msg:"关闭导入查询失败",state:"danger"})}})}},{text:"取消",callback:function(){}}]})}})})(jQuery);(function(a){a.extend({initProgressIndicator:function(f){if(!f||!f.zxjdKey){console.error("缺少参数：执行进度key");return false}var c={title:"进度条",type:"1",width:500,height:300,timeWait:3000,success:{html:"<span>成功!</span>"},error:{html:"<span>失败!</span>"},process:{html:"<span>正在进行中...</span>"}};var d=a.extend(true,{},c,f);var e='<div class="pub-process-widget">';if(d.type=="2"){e+='<div class="process-content bh-clearfix line-process"><div class="line-bar bh-pull-left"><div class="line-bottom"></div><div class="line-top"></div></div><div class="percent bh-pull-left"><span class="number">0</span><span>%</span></div></div>'}else{e+='<div class="process-content circle-process"><div class="circle-bar"><div class="circle-bar-left"></div><div class="circle-bar-right"></div><div class="mask"><span class="percent"><span class="number">0</span><span>%</span></span></div></div></div>'}e+='<div class="process-bottom" data-type="2">'+d.process.html+"</div></div>";BH_UTILS.bhWindow(e,d.title,[],{height:d.height,width:d.width,close:function(){if(d.closeCallback){d.closeCallback()}}});var b=function(){BH_UTILS.doAjax(context_path+"/sys/jwpubapp/modules/gg/T_JW_ZXJD_QUERY.do",{ZXJDKEY:d.zxjdKey},"POST").done(function(g){if(g.code=="0"){if(g.datas&&g.datas.T_JW_ZXJD_QUERY.rows.length>0){var k=g.datas.T_JW_ZXJD_QUERY.rows[0];if(k.ZXBZ=="1"){var i=Number(k.ZS);if(i<=0){console.error("进度总数数据错误");return false}var h=Number(k.YWCS);if(h<0){console.error("进度已完成数数据错误");return false}var j=Math.floor(h/i*100);if(d.type=="2"){a(".pub-process-widget .line-process .line-top").css("width",j+"%")}else{if(j<=50){a(".pub-process-widget .circle-bar-right").css("transform","rotate("+(j*3.6)+"deg)")}else{var l=a(".pub-process-widget .circle-bar").css("background-color");a(".pub-process-widget .circle-bar-right").css({transform:"rotate(0deg)",background:l});a(".pub-process-widget .circle-bar-left").css("transform","rotate("+((j-50)*3.6)+"deg)")}}a(".pub-process-widget .process-content .number").html(j);setTimeout(function(){b()},d.timeWait)}else{if(k.YWCS>=k.ZS){if(d.type=="2"){a(".pub-process-widget .line-process .line-top").css("width","100%")}else{var l=a(".pub-process-widget .circle-bar").css("background-color");a(".pub-process-widget .circle-bar-right").css({transform:"rotate(0deg)",background:l});a(".pub-process-widget .circle-bar-left").css("transform","rotate("+(50*3.6)+"deg)")}a(".pub-process-widget .process-content .number").html("100");a(".pub-process-widget .process-bottom").attr("data-type","1").html(d.success.html);if(d.success.callback){d.success.callback()}}else{a(".pub-process-widget .process-bottom").attr("data-type","0").html(d.error.html);if(d.error.callback){d.error.callback()}}}}else{a.bhTip({content:"未查询到进度",state:"danger"})}}else{a.bhTip({content:"查询进度失败",state:"danger"})}})};b()}})})(jQuery);(function(a){a.extend({initHeadXnxq:function(e){if(!e||!e.dom||!e.zcsdm){console.error("缺少必要参数: dom或zcsdm");return false}if(a(e.dom).length!=1){console.error("元素位置不唯一");return false}if(a(e.dom).find(".head-xnxq-label").length>0){console.error("学年学期组件已存在");return false}var f=function(){var k=[];var g="0123456789abcdef";for(var h=0;h<36;h++){k[h]=g.substr(Math.floor(Math.random()*16),1)}k[14]="4";k[19]=g.substr((k[19]&3)|8,1);k[8]=k[13]=k[18]=k[23]="";var j=k.join("");return j};var b=function(){e.xnxqList=[];BH_UTILS.doAjax(context_path+"/sys/jwpubapp/modules/zdgl/xnxqcx.do",{"*order":"-DM"},"POST",{async:false}).done(function(g){if(g.code=="0"){if(g.datas&&g.datas.xnxqcx.rows.length>0){a.each(g.datas.xnxqcx.rows,function(h,i){e.xnxqList.push({label:i.MC,value:i.DM})})}else{a.bhTip({content:"未查询到学年学期",state:"danger"})}}else{a.bhTip({content:"查询学年学期失败",state:"danger"})}})};var d=function(){var h=a("."+e.key+"-head-xnxq-label");var i={label:h.html(),value:h.attr("data-dm")};var j='<div style="margin-top:10px;"><div class="bh-advancedQuery-groupName" style="width:20%;">学年学期：</div><div class="bh-advancedQuery-groupList"><div class="'+e.key+'-head-xnxq-dropdown"></div></div></div>';BH_UTILS.bhWindow(j,"更改学年学期",[{text:"确定",className:"bh-btn-primary",callback:function(){var k=a("."+e.key+"-head-xnxq-dropdown").jqxDropDownList("getSelectedItem");if(k.value!=i.value){h.attr("data-dm",k.value).html(k.label);if(e.changeCallback){e.changeCallback()}else{if(e.initCallback){e.initCallback()}}}}},{text:"取消",className:"bh-btn-default",callback:function(){}}],{height:"auto",width:"465px"});if(!e.xnxqList){b()}var g=0;a.each(e.xnxqList,function(k,l){if(l.value==i.value){g=k;return false}});a("."+e.key+"-head-xnxq-dropdown").jqxDropDownList({source:e.xnxqList,selectedIndex:g,width:"100%",height:"28px"})};if(!e.key){e.key=f()}var c={ZCSDM:e.zcsdm};if(e.csdm){c.CSDM=e.csdm}BH_UTILS.doAjax(context_path+"/sys/jwpubapp/modules/gg/cxmrxnxq.do",c,"POST").done(function(h){if(h.code=="0"){if(h.datas&&h.datas.cxmrxnxq.rows.length>0){e.mrXnxq=h.datas.cxmrxnxq.rows[0];var g='<label class="bh-form-label '+e.key+'-head-xnxq-label" style="padding: 0px 0px 0px 20px;color: #bbb;" data-dm="'+e.mrXnxq.XNXQDM+'">'+e.mrXnxq.XNXQMC+'</label><a class="'+e.key+'-adjust"  style="font-size: 12px;padding-left: 10px;font-weight: normal;cursor: pointer;">更改</a>';a(e.dom).append(g);a("."+e.key+"-adjust").off("click").on("click",d);if(e.initCallback){e.initCallback()}}else{a.bhTip({content:"未查询到默认学年学期",state:"danger"})}}else{a.bhTip({content:"查询默认学年学期失败",state:"danger"})}})}})})(jQuery);(function(a){a.fn.extend({jwAuthTab:function(f){var p=a(this);if(!f.tabs){a.bhTip({content:"缺少必传字段！",state:"danger"});return}var m=[];for(var h=0;h<f.tabs.length;h++){var d=f.tabs[h];if(!d.title){a.bhTip({content:"缺少标题！",state:"danger"});return}if(d.needAuth&&!d.authId){a.bhTip({content:"缺失权限ID！",state:"danger"});return}var k=BH_UTILS.NewGuid().replace(new RegExp(/(-)/g),"");d.index=k;if(!d.needAuth||a.jwAppConfig.hasPermission(d.authId)){m.push(d)}}f.initTabContent=function(t,u){for(var v=0;v<m.length;v++){var w=m[v];if(w.index==t){if(w.callback&&typeof(w.callback)=="function"){w.callback(u)}break}}};var n=0;var e="<ul>";var r="";for(var h=0;h<m.length;h++){var d=m[h];var c='<li id="'+d.authId+'" class="jwAuthtab-tab-title" data-index="'+d.index+'">'+d.title+"</li>";var g='<div id="'+d.authId+'" class="jwAuthtab-tab-content jwAuthtab-tab-content-'+d.index+' bh-mt-8"></div>';e+=c;r+=g}e+="</ul>";var b='<div class="jwAuthtab-tab">'+e+r+"</div>";p.html(b,true);var s=p.find(".jwAuthtab-tab-title");if(s.length==0){var j='<article bh-layout-role="single"><h2></h2><section class=""><div class="bh-text-center close_img"><img src="../../jwpubapp/public/images/cry.png"></div><div class="bh-text-center"><div class="bh-mt-24 bh-mb-8" style="font-size: 18px;">暂无权限使用</div><div class="open_time"></div></div></section> </article>';p.html(j,true);return}var o={};if(f.extParam){o=f.extParam;if(!o.position){o.position="top"}}else{o.position="top"}p.find(".jwAuthtab-tab").jqxTabs(o);var l=s.eq(0).data("index");var q=p.find(".jwAuthtab-tab-content-"+l);n=l;f.initTabContent(l,q);p.find(".jwAuthtab-tab li").on("click",function(t){var i=a(t.currentTarget).data("index");if(n!=i){q=p.find(".jwAuthtab-tab-content-"+i);f.initTabContent(i,q);n=i}})}})})(jQuery);(function(a){a.extend({jwGetRzxx:function(b){a.jwAjax({url:"/sys/jwpubapp/pub/getRzxx.do",data:{},successMsg:"",success:function(c){b(c)}})},jwGetRzxxSync:function(){var b={};a.jwAjax({url:"/sys/jwpubapp/pub/getRzxx.do",data:{},successMsg:"",async:false,success:function(c){b=c}});return b},jwGetXtcs:function(h,b,e,j){var f={};var k=null;if(typeof h==="string"&&b instanceof Function){f.CSDM=h;k=b}else{if(typeof h==="string"&&typeof b==="string"&&e instanceof Function){f.querySetting='[{"name":"CSDM","value":"'+h+'","builder":"equal","linkOpt":"AND"},{"name":"ZCSDM","value":"'+b+'","builder":"m_value_equal","linkOpt":"AND"}]';k=e}else{if(h instanceof Array&&b instanceof Function){var d="[";for(var g=0;g<h.length;g++){d+='[{"name":"CSDM","value":"'+h[g].CSDM+'","builder":"equal","linkOpt":"'+(g===0?"AND":"OR")+'"},{"name":"ZCSDM","value":"'+h[g].ZCSDM+'","builder":"equal","linkOpt":"AND"}],'}d=d.substring(0,d.length-1);d+="]";f.querySetting=d;k=b}else{a.bhTip({content:"传入参数不合法",state:"warning"});return false}}}if(!j){a.jwAjax({url:"/sys/jwpubapp/modules/gg/cxcs.do",data:{querySetting:f.querySetting},successMsg:"",success:function(i){if(i&&i.rows.length>0){k(i.rows)}}})}else{var c=[];a.jwAjax({url:context_path+"/sys/jwpubapp/modules/gg/cxcs.do",data:f,successMsg:"",async:false,success:function(i){c=i.rows}});return c}},jwSaveXtcs:function(d,c){var b=a.extend({},{url:"/sys/jwpubapp/api/xtcs/save.do",successMsg:"保存成功"},c||{},{data:d});a.jwAjax(b)},jwDeleteXtcs:function(c,b){a.jwAjax({url:"/sys/jwpubapp/api/xtcs/delete.do",data:c,successMsg:"",success:b})},jwInitProgressIndicator:function(h){if(!h||!h.zxjdKey){console.error("缺少参数：执行进度key");return false}var c={title:"进度条",type:"1",width:500,height:320,timeWait:3000,showCloseButton:true,success:{html:"<span>成功!</span>"},error:{html:"<span>失败!</span>"},process:{html:"<span>正在进行中...</span>"}};var g=null;var e=a.extend(true,{},c,h);var f='<div class="pub-process-widget">';if(e.type=="2"){f+='<div class="process-content bh-clearfix line-process"><div class="line-bar bh-pull-left"><div class="line-bottom"></div><div class="line-top"></div></div><div class="percent bh-pull-left"><span class="number">0</span><span>%</span></div></div>'}else{f+='<div class="process-content circle-process"><div class="circle-bar"><div class="circle-bar-left"></div><div class="circle-bar-right"></div><div class="mask"><span class="percent"><span class="number">0</span><span>%</span></span></div></div></div>'}f+='<div class="process-bottom" data-type="2">'+e.process.html+"</div></div>";var d=BH_UTILS.bhWindow(f,e.title,[],{height:e.height,width:e.width,close:function(){if(e.closeCallback){e.closeCallback()}if(g){clearInterval(g)}}});if(e.sync){a(".pub-process-widget").parents('[role="dialog"]').next(".jqx-window-moda1").hide()}a(".jqx-window-close-button.jqx-icon-close").hide();var b=function(){BH_UTILS.doAjax(context_path+"/sys/jwpubapp/api/zxjd/queryProcess.do",{ZXJDKEY:e.zxjdKey},"POST").done(function(i){if(i.code=="0"){if(i.data.code=="0"){var m=i.data;if(m.ZXBZ=="1"){var k=Number(m.ZS);if(k<=0){console.error("进度总数数据错误");return false}var j=Number(m.YWCS);if(j<0){console.error("进度已完成数数据错误");return false}var l=Math.floor(j/k*100);if(e.type=="2"){a(".pub-process-widget .line-process .line-top").css("width",l+"%")}else{if(l<=50){a(".pub-process-widget .circle-bar-right").css("transform","rotate("+(l*3.6)+"deg)")}else{var n=a(".pub-process-widget .circle-bar").css("background-color");a(".pub-process-widget .circle-bar-right").css({transform:"rotate(0deg)",background:n});a(".pub-process-widget .circle-bar-left").css("transform","rotate("+((l-50)*3.6)+"deg)")}}a(".pub-process-widget .process-content .number").html(l);g=setTimeout(function(){b()},e.timeWait);a(".pub-process-widget .process-bottom").attr("data-type","2").find("span").html(m.BZ)}else{if(Number(m.YWCS)>=Number(m.ZS)){a(".jqx-window-close-button.jqx-icon-close").show();if(e.type=="2"){a(".pub-process-widget .line-process .line-top").css("width","100%")}else{var n=a(".pub-process-widget .circle-bar").css("background-color");a(".pub-process-widget .circle-bar-right").css({transform:"rotate(0deg)",background:n});a(".pub-process-widget .circle-bar-left").css("transform","rotate("+(50*3.6)+"deg)")}a(".pub-process-widget .process-content .number").html("100");if(_.isFunction(e.success.html)){a(".pub-process-widget .process-bottom").attr("data-type","1").html(e.success.html(m))}else{a(".pub-process-widget .process-bottom").attr("data-type","1").html(e.success.html)}if(e.showCloseButton){a(".pub-process-widget .process-bottom").attr("data-type","1").append('<br/><button type="button" class="bh-row bh-btn bh-btn-success bh-btn-small jdt-close">关闭</button>');a(".jdt-close").click(function(){d.jqxWindow("close")})}if(e.success.callback){e.success.callback()}if(g){clearInterval(g)}}else{a(".jqx-window-close-button.jqx-icon-close").show();a(".pub-process-widget .process-bottom").attr("data-type","0").html(e.error.html);if(e.showCloseButton){a(".pub-process-widget .process-bottom").attr("data-type","0").append('<br/><button type="button" class="bh-row bh-btn bh-btn-success bh-btn-small jdt-close">关闭</button>');a(".jdt-close").click(function(){d.jqxWindow("close")})}a(".jdt-close").click(function(){d.jqxWindow("close")});if(e.error.callback){e.error.callback()}if(g){clearInterval(g)}}}}else{a.bhTip({content:"未查询到进度",state:"danger"})}}else{a.bhTip({content:"查询进度失败",state:"danger"})}})};b()}})})(jQuery);(function(){var a;a=(function(){function b(e,d){this.options=$.extend({},$.fn.jwXtcsForm.defaults,d);$targetOptions=this.options;var g=WIS_EMAP_SERV.getModel("/modules/"+d.page+".do",d.action,"form");this.$element=$(e);this.$element.attr("csdm",$targetOptions.csdm);this.$element.attr("otherCsdm",JSON.stringify($targetOptions.otherCsdm));var c=[];var f=[];g.map(function(i,h){c.push({CSDM:$targetOptions.otherCsdm&&$targetOptions.otherCsdm[i.name]?$targetOptions.otherCsdm[i.name]:$targetOptions.csdm,ZCSDM:i.name});if(i["form.JSONParam"]&&JSON.parse(i["form.JSONParam"].replace(/'/g,'"')).richText){f.push(i.name)}});this.$element.emapForm({data:g,readonly:false,model:$targetOptions.modelType,easyCheck:true,textareaEasyCheck:true});if(f.length>0){this.$element.attr("cszcSx",JSON.stringify(f));f.map(function(i,h){$(e).find('[data-name="'+i+'"]').emapEditor({height:300,contextPath:contextPath})})}$.jwGetXtcs(c,function(i){var h={};i.map(function(j){h[j.ZCSDM]=f.indexOf(j.ZCSDM)!==-1?j.CSZC:j.CSZA});$(e).emapForm("setValue",h);if(f.length>0){f.map(function(k,j){$(e).find('[data-name="'+k+'"]').emapEditor("setValue",h[k])})}if($targetOptions.render){$targetOptions.render()}});if(d.saveButton){$(d.saveButton).click(function(){if(!$(e).emapValidate("validate")){return}$(e).emapForm("saveUpload");var h=$(e).jwXtcsForm("getValue");$.jwSaveXtcs(h,{success:function(){$targetOptions.successFn()}})})}}b.prototype.getValue=function(){var e=this.$element.attr("csdm");var d=JSON.parse(this.$element.attr("otherCsdm"));var h="";if(this.$element.attr("cszcSx")){h=JSON.parse(this.$element.attr("cszcSx"))}var f=[];if(!this.$element.emapValidate("validate")){return false}var g=this.$element.emapForm("getValue");for(var i in g){if(i.indexOf("_DISPLAY")!==-1){continue}var c={CSDM:d&&d[i]?d[i]:e,ZCSDM:i,CSZA:g[i]};if(h.indexOf(i)!==-1){c.CSZC=this.$element.find('[data-name="'+i+'"]').emapEditor("getValue")}f.push(c)}return f};return b})();$.fn.jwXtcsForm=function(c,d){var b;b=this.data("jwXtcsForm");if(!b){return this.each(function(){if(c=="destroy"){return this}return $(this).data("jwXtcsForm",new a(this,c))})}if(c===true){return b}if($.type(c)==="string"){return b[c](d)}return this};$.fn.jwXtcsForm.defaults={modelType:"h",successFn:function(){},otherCsdm:{}}}).call(this);(function(a){a.fn.extend({jwShowShrz:function(c){if(!c.LCDM||!c.YWZJ||!c.DQZT){a.bhTip({content:"审核日志缺少必传字段！",state:"danger"});return}var b=a(this);BH_UTILS.doAjax(context_path+"/sys/jwpubapp/ztj/getShrzShowDataNew.do",c).done(function(g){if(g.code=="0"){if(g.result&&g.result.length>0){var j="<style>.public-shrz-container{ counter-reset: sectioncounter; }.public-shrz-container .scenes-cbrt-record:first-of-type .scenes-cbrt-record:before{ display: none; }.public-shrz-container .csh-step4-container{ counter-reset: sectioncounter; }.public-shrz-container .scenes-cbrt-no:before { content: counter(sectioncounter); counter-increment: sectioncounter; }.bh-tag-darkgrey{ background-color: #bbb}.scenes-cbrt-no { width: 24px; height: 24px; font-size: 12px; border-radius: 100%; border: 1px solid #2196f3; color: #2196f3; text-align: center; background-color: #fff; margin-top: 24px;}.scenes-cbrt-record:after, .scenes-cbrt-record:before { position: absolute; width: 1px; left: 12px; background-color: #2196f3; z-index: 1; display: block;}.text-font-warning {color:#ef971c;}.text-font-danger {color:#e24034;}</style>";var h='<div class = "csh-step4-container public-shrz-container">';for(var f=0;f<g.result.length;f++){var k=g.result[f];var d='<div class="scenes-cbrt-record  bh-row"><div class="scenes-cbrt-left"><div class="scenes-cbrt-no"></div></div><div class="scenes-cbrt-right"><div class="bh-col-md-12 scenes-cbrt-card-view scenes-cbrt-card-item bh-pt-24">';if(k.ztmc){d+='<h3 class="scenes-cbrt-title">{{ztmc}}</h3>'}if(k.color&&k.status){d+='<a href="javascript:void(0);" class="bh-tag bh-tag-round bh-tag-{{color}} no-active xsjfzzsq-status">{{status}}</a>'}d+='<div class="bh-text-caption bh-caption-default">';if(k.czsj){d+='<div sc-cbrt-role="extend">{{czsj}}</div>'}if(k.czzxm){d+='<div sc-cbrt-role="extend">{{czzxm}}</div>'}if(k.shyj){if(k.SHLX=="3"||k.ZTDM<0){d+='<div sc-cbrt-role="extend" title = "{{shyj}}">意见：<font class = "text-font-{{color}}" > {{shyj1}} </font></div>'}else{d+='<div sc-cbrt-role="extend" >{{shyj}}</div>'}}d+="</div></div> </div> </div>";h+=d.replace("{{ztmc}}",k.ztmc).replace("{{color}}",k.color).replace("{{status}}",k.status).replace("{{czsj}}",k.czsj).replace("{{czzxm}}",k.czzxm).replace("{{shyj}}",k.shyj).replace("{{color}}",k.color);if(k.shyj){h=h.replace("{{shyj1}}",k.shyj.length>26?k.shyj.substr(0,24)+"...":k.shyj)}}h+="</div>";b.html(j+h)}else{var e='<div style="padding-right: 20px;text-align: center;font-size: 16px; width: 100%;">【无流程详情】</div>';b.html(e)}}else{a.bhTip({content:"获取审核日志信息异常！",state:"danger"});return false}})}})})(jQuery);(function(a){a.extend({jwAjax:function(e){var b=null;var c={showLoading:false,isWrapParam:false,successMsg:"操作成功！",errorMsg:"操作失败！{MSG}",isWrapSuccessCallback:true,isWrapErrorCallback:true,type:"POST",async:true};var g=a.extend(c,e);if(g.showLoading){a(".app-ajax-loading").jqxLoader("open")}if(/^(\/sys\/).*/.test(g.url)){g.url=context_path+g.url}else{if(/^(sys\/).*/.test(g.url)){g.url=context_path+"/"+g.url}else{if(/^(\/code\/).*/.test(g.url)){g.url=context_path+g.url}else{if(/^(code\/).*/.test(g.url)){g.url=context_path+"/"+g.url}else{g.url=WIS_EMAP_SERV.getAbsPath(g.url)}}}}if(g.data){if(g.isWrapParam||a.type(g.data)==="array"){g.data={requestParamStr:JSON.stringify(g.data)}}else{g.dataType="json"}}var d=g.error||function(h){};g.error=function(h){if(e.showLoading){a(".app-ajax-loading").jqxLoader("close")}if(g.isWrapErrorCallback){if(h.status===401){BH_UTILS.bhDialogWarning({title:"登录超时",content:"登录超时，您可以尝试刷新页面解决该问题",buttons:[{text:"刷新页面",className:"bh-btn-primary",callback:function(){window.location.reload()}},{text:"关闭",className:"bh-btn-default",callback:function(){}}]})}else{if(h.status===403){BH_UTILS.bhDialogWarning({title:"提示",content:"当前角色权限不足!",buttons:[{text:"确认",className:"bh-btn-warning",callback:function(){}}]})}}if(h.statusText.indexOf("NetworkError")>-1){BH_UTILS.bhDialogDanger({title:"网络错误",content:"您可以尝试刷新页面解决该问题",buttons:[{text:"刷新页面",className:"bh-btn-primary",callback:function(){window.location.reload()}},{text:"关闭",className:"bh-btn-default"}]})}}d(h)};var f=g.success||function(h){};g.success=function(k){b=k;if(e.showLoading){a(".app-ajax-loading").jqxLoader("close")}if(g.isWrapSuccessCallback){var h=g.url.split("/").pop();if(/\.do$/.test(h)){h=h.substring(0,h.length-3)}var i=new RegExp(context_path+"/code");if(i.test(g.url)){h="code"}if(k.code==="0"){if(!k.datas||Object.keys(k.datas).length>1||!k.datas.hasOwnProperty(h)){console.warn("不是标准的返回格式，请注意自行处理返回值（只需要处理resp.code='1'的数据）");f(k);if(g.successMsg&&g.successMsg.length>0){a.bhTip({content:g.successMsg.replace(/{MSG}/g,k.msg||""),state:"success"})}}else{if(k.datas[h]&&k.datas[h].extParams&&k.datas[h].extParams.code!==1){k.datas[h].extParams.msg=(k.datas[h].extParams.msg||"");BH_UTILS.bhDialogWarning({title:"提示",content:g.errorMsg.replace(/{MSG}/g,k.datas[h].extParams.msg),buttons:[{text:"确认",className:"bh-btn-warning",callback:function(){}}]});if(a.type(d)==="function"){d(k)}}else{b=k.datas[h];f(k.datas[h]);if(g.successMsg&&g.successMsg.length>0){var j=(k.datas[h]&&k.datas[h].extParams)?(k.datas[h].extParams.msg||""):(k.msg||"");a.bhTip({content:g.successMsg.replace(/{MSG}/g,j),state:"success"})}}}}else{if(k.code==="1"){k.msg=k.msg||"";BH_UTILS.bhDialogWarning({title:"提示",content:g.errorMsg.replace(/{MSG}/g,k.msg),buttons:[{text:"确认",className:"bh-btn-warning",callback:function(){}}]});if(a.type(d)==="function"){d(k)}}else{if(k.code==="#E2140100002"){BH_UTILS.bhDialogWarning({title:"提示",content:"请求参数存在非法内容！",buttons:[{text:"确认",className:"bh-btn-warning",callback:function(){}}]});if(a.type(d)==="function"){d(k)}}else{BH_UTILS.bhDialogWarning({title:"提示",content:"后台数据异常，请联系管理员！",buttons:[{text:"确认",className:"bh-btn-warning",callback:function(){}}]});if(a.type(d)==="function"){d(k)}}}}}else{f(k)}};a.ajax(g);return b},jwChecker:function(c,g,f){var b=false;f=f||{};var e=a.extend({},{appname:WIS_CONFIG.APPNAME},f.data||{},{checkerNames:c},g);var d=a.extend({},{url:"/sys/jwpubapp/checker/check.do",async:false,successMsg:"",success:function(h){b=true}},f,{data:e});a.jwAjax(d);return b}})})(jQuery);(function(c){var h=(function(){function j(w,D){var W=c.extend(true,{},c.fn.jwQueryAndTable.defaults,D);if(!W.emapTable.pageSizeOptions&&window.emapdatatableDefaultPageSize){var H=parseInt(window.emapdatatableDefaultPageSize);W.emapTable.pageSize=H;if(H<=20){W.emapTable.pageSizeOptions=[H,H*2,H*5,H*10]}else{if(H<=40){W.emapTable.pageSizeOptions=[H,H*2,H*5]}else{if(H<=100){W.emapTable.pageSizeOptions=[H,H*2]}else{W.emapTable.pageSizeOptions=[H]}}}}if(!W.emapTable.height&&window.emapdatatableDefaultHeight&&window.emapdatatableDefaultHeight!=="normal"){W.emapTable.height=window.emapdatatableDefaultHeight}if(!(c.type(W.altRows)==="boolean")&&c.type(window.emapdatatableDefaultAltRows)==="boolean"){W.altRows=window.emapdatatableDefaultAltRows}W.emapTable.pagePath=W.emapTable.pagePath||W.pagePath;W.pagePath=W.pagePath||W.emapTable.pagePath;W.emapTable.action=W.emapTable.action||W.action;W.action=W.action||W.emapTable.action;W.emapTable.params=W.emapTable.params||W.params;W.params=W.params||W.emapTable.params;if(!W.action||!W.pagePath){console.error("缺少必传参数！");return}if(W.hasExport&&(!W.fileName||W.fileName.length<=0)){console.error("设置允许导出功能时[hasExport=true]必须设置导出文件名[fileName]！");return}if(W.searchType!=="emapAdvancedQuery"&&W.searchType!=="emapFilterQuery"){console.error("[emapAdvancedQuery]只能设置成[emapAdvancedQuery]或[emapFilterQuery]！");return}var J=c.extend(true,[],W.emapQuery.hiddenCols||W.hiddenCols);var L=c.extend(true,[],W.hiddenCols);var U=c.extend(true,[],W.emapQuery.onlyCols||W.onlyCols);var s=c.extend(true,[],W.onlyCols);if(W.hasSearch&&!W.emapQuery.data){W.emapQuery.data=WIS_EMAP_SERV.getModel(W.pagePath,W.action,"search",W.params);W.emapQuery.data.controls=W.emapQuery.data.controls.filter(function(aa){return !aa["search.hidden"]})}if(W.params){c.each(W.params,function(aa,ab){J.push(aa)})}if(W.hasSearch){W.emapQuery.data.controls=W.emapQuery.data.controls.filter(function(aa){return J.indexOf(aa.name)<0&&(U.length<=0||U.indexOf(aa.name)>=0)})}if(W.hasSearch&&W.changeDataModel){W.emapQuery.data.controls=W.changeDataModel(W.emapQuery.data.controls,true)}W.emapTable.datamodel=W.emapTable.datamodel||WIS_EMAP_SERV.getModel(W.pagePath,W.action,"grid",D.params);W.emapTable.datamodel=W.emapTable.datamodel.filter(function(aa){return L.indexOf(aa.name)<0&&(s.length<=0||s.indexOf(aa.name)>=0)});if(W.changeDataModel){W.emapTable.datamodel=W.changeDataModel(W.emapTable.datamodel,false)}if(W.hasSearch){var E=[];c.each(W.complexSearchCols,function(ab,ac){var aa=false;c.each(W.emapQuery.data.controls,function(ad,ae){if(ae.name===ac){var af=ae["search.xtype"]||ae.xtype;aa=ae.dataType==="String"&&(!af||af==="text");return false}});if(aa){E.push(ac)}});W.complexSearchCols=E;var x=[];if(W.searchType==="emapFilterQuery"){c.each(W.emapQuery.data.controls,function(aa,ab){if(ab.quickSearch===true&&W.requiredCols.indexOf(ab.name)>=0){x.push(ab)}});var X="";c.each(W.requiredCols,function(aa,ac){var ab=false;c.each(x,function(ad,ae){if(ac===ae.name){ab=true;return false}});if(!ab){if(X.length>0){X+=","}X+=ac}});if(X.length>0){console.warn("【requiredCols】中设置的【"+X+"】字段不存在在于搜索模型中或没有设置为快速搜索")}}}var Q=c(w);this.$element=Q;if(W.tpl){Q.html(W.tpl)}var k=W.$searchDom||Q.find(".jwqueryandtable-search");var Z=W.$tableDom||Q.find(".jwqueryandtable-table");var M=BH_UTILS.NewGuid();k.addClass(M);var u=k.selector+"."+M;var I=BH_UTILS.NewGuid();Z.addClass(I);var C=Z.selector+"."+I;var T=W.$buttonsDom||Q.find(".jwqueryandtable-btns");if(T.length<=0&&(W.hasZdyl||W.hasExport||W.buttons.length>0)){console.warn("操作按钮对应的Dom不存在，无法渲染操作按钮！")}if(Z.length<=0){console.error("表格对应的Dom不存在!",Z);return}var n={text:"",className:"bh-btn-default",canBatch:true,canSingle:false,needValidateCheckedRecords:true,beforeRender:null,callback:function(ab,aa){console.log("checkedOrSearchQuerySetting:",ab,"$target:",aa)}};c.each(W.buttons,function(aa,ab){W.buttons[aa]=c.extend({},n,ab)});if(W.needPermission){c.each(W.buttons,function(aa,ab){if(ab.children){ab.children=ab.children.filter(function(ac){return !ac.permissionKey||c.jwAppConfig.hasPermission(ac.permissionKey)});if(ab.children.length<=0){ab.shouldHidden=true}}});W.buttons=W.buttons.filter(function(aa){return(!aa.permissionKey||c.jwAppConfig.hasPermission(aa.permissionKey))&&!aa.shouldHidden})}var r='<div class="bh-pull-left bh-mb-8">';var N='<div class="bh-pull-right bh-mb-8">';var F=0;c.each(W.buttons,function(aa,ab){if(ab.canBatch){if(ab.children&&ab.children.length>0){r+='<div class="bh-dropdown '+ab.className.replace(/bh-btn-/g,"bh-dropdown-")+'" bh-dropdown-role="bhDropdown" style="display: inline-block;margin-left: 4px;">    <button class="bh-btn '+ab.className+' bh-btn-larger" type="button" bh-dropdown-role="bhDropdownBtn" >'+ab.text+'    </button>    <ul class="bh-dropdown-menu" bh-dropdown-role="bhDropdownMenu">';c.each(ab.children,function(ad,ac){r+='<li><a href="javascript:void(0)" class="jwqueryandtable-button-'+aa+"-"+ad+'" >'+ac.text+"</a></li>";T.on("click",".jwqueryandtable-button-"+aa+"-"+ad,function(){var ae=d(Q,W);if((ac.needValidateCheckedRecords==null||ac.needValidateCheckedRecords)&&!ae.hasRecord){c.bhTip({content:"没有可操作的记录!",state:"danger"});return false}ac.callback(ae,c(this))})});r+="</ul></div>"}else{r+='<a href="javascript:void(0)" class="bh-btn '+ab.className+" jwqueryandtable-button-"+aa+'" >'+ab.text+"</a>";T.on("click",".jwqueryandtable-button-"+aa,function(){var ac=d(Q,W);if(ab.needValidateCheckedRecords&&!ac.hasRecord){c.bhTip({content:"没有可操作的记录!",state:"danger"});return false}ab.callback(c.extend({},ac,{isSingle:false}),c(this))})}}if(ab.canSingle&&!ab.children){F+=F>0?(ab.text.length*15+15):(ab.text.length*15)}});if(W.hasExport&&(!W.hasExportPermission||c.jwAppConfig.hasPermission(W.hasExportPermission))){r+='<a href="javascript:void(0)" class="bh-btn bh-btn-default '+W.action+'-export" data-disabled="0">导出</a>';var K=W.pagePath.split("/").pop();if(/\.do$/.test(K)){K=K.substring(0,K.length-3)}var q=W.pagePath.split("/").shift();T.on("click","."+W.action+"-export",function(ac){var aa=c(ac.currentTarget);if(aa.attr("data-disabled")==="1"){c.bhTip({content:"操作太频繁啦！请10s后再试。",state:"warning"});return false}aa.attr("data-disabled","1");var ab=d(Q,W);if(!ab.hasRecord){c.bhTip({content:"表格中没有可导出的记录!",state:"danger"});aa.attr("data-disabled","0");return false}var ad=c.extend({},W.emapTable.params||{},Z.data("initParams"));c.publicExportFn({tableSelector:C,querySelector:W.hasSearch?u:null,querySetting:ab.querySetting,params:ad,action:W.action,fileName:W.fileName,appName:WIS_CONFIG.APPNAME,module:q,pageName:K,tableKey:W.emapTable.pk,queryType:W.searchType,isGrid:false,analyse:W.analyse,write:W.write});setTimeout(function(){aa.attr("data-disabled","0")},10000)})}if(W.hasZdyl){N+='<div style="margin:5px 0;">    <span class="bh-switch-item bh-switch-setting '+W.action+'-zdyl" style="margin-right: 8px;cursor: pointer;">        <i class="iconfont icon-zidingyixianshilie"></i>        <span>自定义列</span>    </span></div>';T.on("click","."+W.action+"-zdyl",function(){Z.emapdatatable("selectToShowColumns")})}r+="</div>";N+="</div>";T.append(r).prepend(N).append('<div class="bh-clearfix"></div>');if(W.hasSearch&&k.length>0){var m={njColName:false,yxColName:false,zyColName:false,zyfxColName:false,bjColName:false};c.each(W.emapQuery.data.controls,function(aa,ab){if(W.autoLink){c.each(m,function(ac,ad){if(ab.name===W[ac]){m[ac]=true}})}if(!ab["search.xtype"]){switch(ab.dataType){case"double":case"int":case"long":ab["search.xtype"]="number-range";break;case"Timestamp":case"Date":ab["search.xtype"]="date-range";break}}});var y=W.emapQuery.onSearch;delete W.emapQuery.onSearch;if(W.searchType==="emapAdvancedQuery"){k.emapAdvancedQuery(W.emapQuery);if(m.njColName&&m.yxColName&&m.zyColName){c.autoLinkStuSearch(u,{XZNJ:W.njColName,YXDM:W.yxColName,ZYDM:W.zyColName,ZYFXDM:W.zyfxColName,BJDM:W.bjColName},m.zyfxColName,m.bjColName)}k.on("search",function(ab,ac,aa){var ad=i(Q,ac);if(y){y(ac,aa,ab)}else{Z.emapdatatable("reloadFirstPage",ad)}});if(W.params&&W.params.querySetting){k.emapAdvancedQuery("setValue",W.params.querySetting)}}else{var Y=W.emapQuery.beforeSearch;delete W.emapQuery.beforeSearch;var l=W.emapQuery.beforeReload;delete W.emapQuery.beforeReload;W.emapQuery.onSearch=function(ab){if(Y&&c.type(Y)==="function"){if(Y(ab)===false){return}}var aa="";c.each(x,function(ad,af){var ae=k.find('[data-name="'+af.name+'"]');var ag=ae.val();if(ag===null||ag===undefined||ag===""){if(aa.length>0){aa+="、"}aa+=af.caption}});if(aa.length>0){c.bhTip({content:aa+"不能为空",state:"danger"});return false}Z.show();T.show();var ac=i(Q,ab);if(l&&c.type(l)==="function"){ac=l(ac)}if(y){y(ab)}else{Z.emapdatatable("reloadFirstPage",ac)}};if(m.njColName&&m.yxColName&&m.zyColName){var v=W.emapQuery.afterRender;W.emapQuery.afterRender=function(){c.autoLinkStuSearch(u,{XZNJ:W.njColName,YXDM:W.yxColName,ZYDM:W.zyColName,ZYFXDM:W.zyfxColName,BJDM:W.bjColName},m.zyfxColName,m.bjColName);if(c.type(v)==="function"){v()}}}var G=W.emapQuery.afterRender;W.emapQuery.afterRender=function(){c.each(W.complexSearchCols,function(ab,ac){var aa=k.find('div[data-field="'+ac+'"]');aa.find(".emap-FQ-label").css("color","#2196F3").css("cursor","pointer");aa.off("click",".emap-FQ-label").on("click",".emap-FQ-label",function(ah){var ae=c(ah.currentTarget);var ai=ae.parent().find("[data-name][data-caption]");var ag=ae.html();var ad=ai.val();var af=BH_UTILS.bhWindow('<div class="bh-alert bh-alert-warning">    <p>1. 每行代表一个【'+ag+'】，可从其他途径复制粘贴</p>    <p>2. 重复项只会被保留一个</p>    <p>3. 每项的前后空格将会被去除</p></div><textarea class="textarea"></textarea>',ag+"（批量查询）",[{text:"确定",className:"bh-btn-primary",callback:function(){var ak=af.find(".textarea").val().split(/\n/g);for(var aj=0;aj<ak.length;aj++){ak[aj]=ak[aj].trim();if(ak[aj]===""){ak.splice(aj,1)}}ak=ak.filter(function(am,al){return ak.indexOf(am)===al});ai.val(ak.toString())}}],{height:"580px"});af.find(".textarea").jqxTextArea({height:350});af.find(".textarea").val(ad.replace(/,/g,"\n"))})});if(c.type(G)==="function"){G()}};k.emapFilterQuery(W.emapQuery);if(!W.showSearchKey){k.find('[data-field="_commonFilter"]').hide()}if(W.params&&W.params.querySetting){k.emapFilterQuery("setValue",W.params.querySetting)}}}if(W.hasSearch&&W.searchType==="emapFilterQuery"&&k.length>0){c.each(x,function(aa,ac){var ab=k.find('div[data-field="'+ac.name+'"]');if(ab.length===0){return true}ab.find(".emap-FQ-label").prepend('<span style="color: #f00;margin-right: 3px;">*</span>')});if(x.length>0){Z.hide();T.hide();W.emapTable.isOnceEmpty=true}}W.emapTable.customColumns=W.emapTable.customColumns||[];var o=false;var P=false;c.each(W.emapTable.customColumns,function(aa,ab){if(ab.type==="checkbox"){o=true}if(ab.isOperationCol){if(P){console.warn("存在多个操作列，将使用第一个操作列")}P=true}});if(W.hasCheckbox&&!o){W.emapTable.customColumns.push({colIndex:"0",type:"checkbox",pinned:true});o=true}if(F>0){F=F<100?100:F;var z={colIndex:o?"1":"0",type:"tpl",column:{text:"操作",align:"center",cellsalign:"center",width:F+"px",pinned:true,cellsRenderer:function(af,ac,ae,ad){var ab=ad[W.emapTable.pk];Z.off("click",".jwqueryandtable-button-table-"+af).on("click",".jwqueryandtable-button-table-"+af,function(){var ai=c(this);var ah=ai.attr("data-btn-index");var ag=ab+"###"+ah;c.each(W.buttons,function(ak,am){if(parseInt(ah)===ak&&c.type(am.callback)==="function"){if(am.type==="btn-select"){var ao=Z.data("selectedRowBtnKeys")||[];var aj=ao.indexOf(ag)>=0;var al=aj;if(!aj){ao=[];ao.push(ag);Z.data("selectedRowBtnKeys",ao);Z.jqxDataTable("clearSelection");Z.jqxDataTable("selectrowbykey",ab);al=!aj}else{if(am.canCancelSelect){ao=[];Z.data("selectedRowBtnKeys",ao);Z.jqxDataTable("clearSelection");al=!aj}}if(al===aj){return}}var ap=c.extend({},W.emapTable.params||{},Z.data("initParams"));var an=g(ap)||[];an.push({name:W.emapTable.pk,value:ad[W.emapTable.pk],builder:"equal",linkOpt:"and"});am.callback({querySetting:JSON.stringify(an),isChecked:false,isSingle:true,hasRecord:true,isRowSelected:al,records:[ad]},ai)}})});var aa="";c.each(W.buttons,function(ak,al){var ai=al.canSingle;if(al.beforeRender&&c.type(al.beforeRender)==="function"&&!al.beforeRender(al,ad)){return true}var ah=ab+"###"+ak;var am=Z.data("selectedRowBtnKeys")||[];var aj=am.indexOf(ah)>=0;if(ai){var ag=(aj&&al.type==="btn-select"?(al.selectedText||al.text):al.text);var an=(aj&&al.type==="btn-select"?"bh-color-danger":"");if(aa.length>0){aa+=" | "}aa+='<a href="javascript:void(0);" data-btn-index="'+ak+'" class="jwqueryandtable-button-table-'+af+" "+an+'">'+ag+"</a>"}});return aa}}};if(P){c.each(W.emapTable.customColumns,function(aa,ab){if(ab.isOperationCol){ab=c.extend(true,{},z,ab);delete ab.isOperationCol;W.emapTable.customColumns[aa]=ab;return false}})}else{W.emapTable.customColumns.push(z)}}if(!W.hasSearch&&(W.emapTable.isOnceEmpty===undefined||W.emapTable.isOnceEmpty===null)){W.emapTable.isOnceEmpty=false}if(W.isPageableCheck){if(c.type(W.checkedLableName)!=="string"||W.checkedLableName.length<=0){console.error("开启了分页勾选【isPageableCheck:true】后，必须设置分页勾选展示的标签所显示的内容【checkedLableName】(checkedLableName支持使用表格数据字段使用{}包裹来填充，如需要显示”课程名[课程号]“可设置为”{KCM}[{KCH}]“)");return false}var p=W.$checkedContainerDom||Q.find(".jwqueryandtable-checked-container");p.addClass("jwqueryandtable-checked-container");p.addClass("bh-bColor-info-3");if(c.type(W.defaultCheckedRecords)!=="array"){W.defaultCheckedRecords=[]}p.data("value",c.extend([],W.defaultCheckedRecords));var S='<span class="message">已选<span class="number">'+W.defaultCheckedRecords.length+'</span>条数据</span><a class="btn-clear" href="javascript:void(0);">清空</a><span class="data">';c.each(W.defaultCheckedRecords,function(aa,ab){S+=f(W,ab)});S+="</span>";p.html(S);Z.on("click","input",function(){var ab=c(this).val();var ad=c(this).is(":checked");var ac=null;c.each(Z.jqxDataTable("getRows"),function(ae,af){if(af.uid===ab){ac=af;return false}});if(c.type(W.pageableCheckBefore)==="function"){var aa=W.pageableCheckBefore([ac]);if(aa===false){b(W,Z,p);return false}}if(ad){e(W,p,ac)}else{a(W,p,ab)}});Z.on("checkall","input",function(){var ac=c(this).is(":checked");var ab=Z.jqxDataTable("getRows");if(c.type(W.pageableCheckBefore)==="function"){var aa=W.pageableCheckBefore(ab);if(aa===false){b(W,Z,p);return false}}c.each(ab,function(ad,ae){if(ac){e(W,p,ae)}else{a(W,p,ae[W.emapTable.pk])}})});p.on("click","a.btn-clear",function(){a(W,p);b(W,Z,p)});p.on("click",".data>label>.icon-close",function(){var aa=c(this).parent().attr("data-value");a(W,p,aa);b(W,Z,p)});var R=W.emapTable.rendered;W.emapTable.rendered=function(){b(W,Z,p);if(c.type(R)==="function"){R()}}}else{Q.find(".jwqueryandtable-checked-container").remove()}var A=[];var t={};var B="";var V=false;c.each(W.emapTable.datamodel,function(aa,ab){if(ab.groupName){t[ab.name]=ab.groupName;t[ab.name+"_DISPLAY"]=ab.groupName;if(A.indexOf(ab.groupName)<0){A.push(ab.groupName);B=ab.groupName}else{if(B!==ab.groupName){console.error("模型中相同分组的字段必须在一起！");V=true;return false}}}else{B=""}});if(V){return}var O=W.emapTable.customOptions;W.emapTable.customOptions=function(aa){if(c.type(W.altRows)==="boolean"){aa.altRows=W.altRows}if(A.length>0){aa.columnGroups=[];c.each(A,function(ab,ac){aa.columnGroups.push({text:ac,align:"center",name:"group-"+ab})});c.each(aa.columns,function(ab,ac){if(t.hasOwnProperty(ac.datafield)){ac.columngroup="group-"+A.indexOf(t[ac.datafield])}})}if(c.type(O)==="function"){aa=O(aa)}return aa};Z.emapdatatable(W.emapTable);Z.on("bindingComplete",function(ab){var aa=Z.emapdatatable("getRowsData");var ac=[];var ad=Z.data("selectedRowBtnKeys")||[];c.each(ad,function(ae,ag){var af=ag.split("###")[0];c.each(aa,function(ah,ai){if(af===ai[W.emapTable.pk]){ac.push(ag);Z.jqxDataTable("selectrowbykey",af)}})});Z.data("selectedRowBtnKeys",ac)});Q.data("jwQueryAndTable-options",W)}j.prototype.getOptions=function(){return this.$element.data("jwQueryAndTable-options")};j.prototype.refreshTable=function(n){var s=this.$element.data("jwQueryAndTable-options");var o=s.$searchDom||this.$element.find(".jwqueryandtable-search");var r=s.$tableDom||this.$element.find(".jwqueryandtable-table");var k=null;if(n&&n.querySetting){k=n.querySetting}n=c.extend({},s.emapTable.params||{},r.data("initParams"),{_gotoFirstPage:true},n);delete n.querySetting;r.data("initParams",n);var m=c.extend({},n);if(k){m.querySetting=k}if(s.hasSearch&&o.length>0){var p=m.querySetting;m.querySetting=s.searchType==="emapAdvancedQuery"?o.emapAdvancedQuery("getValue"):o.emapFilterQuery("getValue");if(p){var l=JSON.parse(m.querySetting);l.push(JSON.parse(p));m.querySetting=JSON.stringify(l)}}if(s.addExtParamBeforeReload&&c.type(s.addExtParamBeforeReload)==="function"){var q=s.addExtParamBeforeReload(m);if(c.type(q)!=="object"){console.warn("addExtParamBeforeReload返回值不是json对象，该处理将被忽略")}else{m=c.extend({},m,q)}}r.emapdatatable("reload",m,function(){})};j.prototype.getQuery=function(){var k=this.$element.data("jwQueryAndTable-options");return k.$searchDom||this.$element.find(".jwqueryandtable-search")};j.prototype.getTable=function(){var k=this.$element.data("jwQueryAndTable-options");return k.$tableDom||this.$element.find(".jwqueryandtable-table")};j.prototype.getReloadParams=function(){var l=this.$element.data("jwQueryAndTable-options");var n=l.$searchDom||this.$element.find(".jwqueryandtable-search");var k=l.$tableDom||this.$element.find(".jwqueryandtable-table");var o=k.data("initParams");if(l.hasSearch&&n.length>0){o.querySetting=l.searchType==="emapAdvancedQuery"?n.emapAdvancedQuery("getValue"):n.emapFilterQuery("getValue")}if(l.addExtParamBeforeReload&&c.type(l.addExtParamBeforeReload)==="function"){var m=l.addExtParamBeforeReload(o);if(c.type(m)!=="object"){console.warn("addExtParamBeforeReload返回值不是json对象，该处理将被忽略")}else{o=c.extend({},o,m)}}return o};j.prototype.clearSelection=function(){var l=this.$element.data("jwQueryAndTable-options");var k=l.$tableDom||this.$element.find(".jwqueryandtable-table");k.data("selectedRowBtnKeys",[]);k.jqxDataTable("clearSelection")};j.prototype.getCheckedOrSearchQuerySetting=function(){var k=this.$element.data("jwQueryAndTable-options");return d(this.$element,k)};j.prototype.getCheckedRecords=function(){var k=this.$element.data("jwQueryAndTable-options");var l=k.$checkedContainerDom||this.$element.find(".jwqueryandtable-checked-container");return l.data("value")};j.prototype.clearCheckedRecords=function(){var l=this.$element.data("jwQueryAndTable-options");var m=l.$checkedContainerDom||this.$element.find(".jwqueryandtable-checked-container");var k=l.$tableDom||this.$element.find(".jwqueryandtable-table");a(l,m);b(l,k,m)};j.prototype.refreshCheckedRecords=function(n){var l=this.$element.data("jwQueryAndTable-options");var m=l.$checkedContainerDom||this.$element.find(".jwqueryandtable-checked-container");var k=l.$tableDom||this.$element.find(".jwqueryandtable-table");l=c.extend({},l,n);if(c.type(l.defaultCheckedRecords)!=="array"){l.defaultCheckedRecords=[]}m.data("value",c.extend([],l.defaultCheckedRecords));var o='<span class="message">已选<span class="number">'+l.defaultCheckedRecords.length+'</span>条数据</span><a class="btn-clear" href="javascript:void(0);">清空</a><span class="data">';c.each(l.defaultCheckedRecords,function(p,q){o+=f(l,q)});o+="</span>";m.html(o);b(l,k,m)};return j})();function d(q,l){var r=l.searchType;var p=l.$searchDom||q.find(".jwqueryandtable-search");var t=l.$tableDom||q.find(".jwqueryandtable-table");var n=l.emapTable.pk;var m=c.extend({},l.emapTable.params||{},t.data("initParams"));var k=g(m)||[];var o=t.emapdatatable("checkedRecords");if(o.length>0){var j=[];c.each(o,function(u,v){j.push(v[n])});k.push({name:n,value:j.join(","),builder:"m_value_equal",linkOpt:"and"});return{querySetting:JSON.stringify(k),isChecked:true,hasRecord:true,records:o}}else{if(l.hasSearch&&p.length>0){var s=i(q,p[r]("getValue"));if(s.querySetting){k.push(JSON.parse(s.querySetting))}}else{if(l&&l.params&&l.params.querySetting){k.push(JSON.parse(l.params.querySetting))}}return{querySetting:JSON.stringify(k),isChecked:false,hasRecord:t.emapdatatable("getRowsData").length>0,records:[]}}}function i(p,k){var l=p.data("jwQueryAndTable-options");var n=l.$searchDom||p.find(".jwqueryandtable-table");k=k||n[l.searchType]("getValue");var j=JSON.parse(k);if(l.searchType==="emapFilterQuery"){c.each(j,function(q,r){if(l.complexSearchCols.indexOf(r.name)>-1&&r.builder==="m_value_include"){r.builder="m_value_equal"}})}var o={querySetting:JSON.stringify(j)};if(l.addExtParamBeforeReload&&c.type(l.addExtParamBeforeReload)==="function"){var m=l.addExtParamBeforeReload(o);if(c.type(m)!=="object"){console.warn("addExtParamBeforeReload返回值不是json对象，该处理将被忽略")}else{o=c.extend({},o,m)}}return o}function g(k){if(k&&c.type(k)==="object"){var j=[];c.each(k,function(l,m){if(c.type(m)!=="string"&&c.type(m)!=="number"){console.warn("params中【"+l+"】参数不是字符串或数值，将被忽略。"+l+":",m);return true}if(l!=="querySetting"&&l!=="*order"&&l!=="_gotoFirstPage"){j.push({name:l,value:m,builder:m.indexOf(",")>-1?"m_value_equal":"equal",linkOpt:"and"})}});return j}return null}function f(l,m){var k=m[l.emapTable.pk];var j=l.checkedLableName;c.each(m,function(n,o){j=j.replace(new RegExp("{"+n+"}","ig"),o)});return'<label data-value="'+k+'" class="bh-tag bh-tag-primary bh-no-active bh-bg-primary">    <span>'+j+'</span>    <i style="cursor: pointer;" class="iconfont icon-close"></i></label>'}function b(m,j,l){var k=l.data("value");j.find('input[type="checkbox"]').removeAttr("checked");c.each(k,function(n,o){var p=o.uid?o.uid:o[m.emapTable.pk];j.find("input[value='"+p+"']").prop("checked","checked")})}function e(m,l,n){if(!n){return}var k=l.data("value");var j=false;c.each(k,function(o,p){if(p[m.emapTable.pk]===n[m.emapTable.pk]){j=true;return false}});if(j){return}k.push(n);l.find(".data").append(f(m,n));l.data("value",k);l.find(".number").html(k.length)}function a(l,k,m){c.each(k.find(".data>.bh-tag"),function(n,o){if(!m||c(this).attr("data-value")===m){c(this).remove()}});var j=k.data("value");j=j.filter(function(n){return m&&n[l.emapTable.pk]!==m});k.data("value",j);k.find(".number").html(j.length)}c.fn.jwQueryAndTable=function(k,l){var j;j=this.data("jwQueryAndTable");if(!j||(c.type(k)==="object"&&k.forceInit===true)){return this.each(function(){return c(this).data("jwQueryAndTable",new h(this,k))})}if(k===true){return j}if(c.type(k)==="string"){return j[k](l)}return this};c.fn.jwQueryAndTable.defaults={pagePath:null,action:null,forceInit:false,hiddenCols:[],onlyCols:[],params:null,tpl:'<div class="jwqueryandtable-search"></div><div class="jwqueryandtable-btns"></div><div class="jwqueryandtable-checked-container"></div><div class="jwqueryandtable-table"></div>',$tableDom:null,$searchDom:null,$buttonsDom:null,$checkedContainerDom:null,needPermission:true,buttons:[],hasSearch:true,requiredCols:[],complexSearchCols:[],hasZdyl:true,hasCheckbox:true,altRows:null,isPageableCheck:false,checkedLableName:null,defaultCheckedRecords:[],hasExport:false,searchType:"emapFilterQuery",autoLink:true,njColName:"XZNJ",yxColName:"YXDM",zyColName:"ZYDM",zyfxColName:"ZYFXDM",bjColName:"BJDM",showSearchKey:false,changeDataModel:null,emapQuery:{showBlankOption:false,showTotalNum:true,beforeSearch:null,beforeReload:null,onSearch:null},emapTable:{pk:"WID",fastRender:true,sortable:true,height:null,minLineNum:10,rendered:function(){}}}})(jQuery);(function(c){var b=(function(){function e(h,f){this.$element=c(h);var i=c.extend(true,{},c.fn.jwForm.defaults,f);if(i.isDatamodelProcessed){delete i.isDatamodelProcessed}else{i=a(i)}if(!i.data&&(!i.action||!i.pagePath)){console.error("缺少必传参数！(pagePath,action和data必须填入一个)");return}var g={};if(c.type(i.autocompleteCols)==="array"){c.each(i.autocompleteCols,function(j,k){if(k.type==="T_KC_KCB"){k=c.extend({},{url:"/sys/jwpubapp/modules/bdzdtc_dsjqx/cxkcxx.do",valueMember:"KCH",searchMember:["KCH","KCM"],labelTpl:"{KCM}【{KCH}】"},k)}else{if(k.type==="T_XS_JBXX"){k=c.extend({},{url:"/sys/jwpubapp/modules/bdzdtc_dsjqx/cxxsxx.do",valueMember:"XH",searchMember:["XH","XM"],labelTpl:"{XM}【{XH}】"},k)}else{if(k.type==="T_JZG_JBXX"){k=c.extend({},{url:"/sys/jwpubapp/modules/bdzdtc_dsjqx/cxjzgxx.do",valueMember:"ZGH",searchMember:["ZGH","XM"],labelTpl:"{XM}【{ZGH}】"},k)}else{if(k.type==="T_FA_FAB"){k=c.extend({},{url:"/sys/jwpubapp/modules/bdzdtc_dsjqx/cxpyfaxx.do",valueMember:"PYFADM",searchMember:["NJMC","PYFAMC"],labelTpl:"{PYFAMC}【{NJMC}】"},k)}else{if(k.type==="T_JAS_JBXX"){k=c.extend({},{url:"/sys/jwpubapp/modules/bdzdtc_dsjqx/cxjsxx.do",valueMember:"JASDM",searchMember:["JASDM","JASMC","JXLMC"],labelTpl:"{JXLMC}/{JASMC}【{JASDM}】"},k)}}}}}g[k.name]=c.extend({},{url:d(k.url),minLength:1,enableQuerySetting:true,searchMember:k.searchMember,hideMember:[k.valueMember],valueMember:k.valueMember,displayMember:"label",formatData:function(l){l.pageSize=10;if(c.type(l.querySetting)==="string"){var m=JSON.parse(l.querySetting)[0];if(m&&m.value===""){l.querySetting="[]"}}},beforeRender:function(n,p,o){if(!p[k.valueMember]){if(!p.label){p.label=""}return p}var l={};var m=k.labelTpl;c.each(p,function(q,r){m=m.replace(new RegExp("{"+q+"}","ig"),r)});l[k.valueMember]=p[k.valueMember];l.label=m;return l},renderSelectedItem:function(l,m){var o=JSON.parse(m.label);var n=k.labelTpl;c.each(o,function(p,q){n=n.replace(new RegExp("{"+p+"}","ig"),q)});if(c.type(k.renderSelectedItem)==="function"){k.renderSelectedItem(l,m,c(h),o)}return n}},i.itemOptions?i.itemOptions[k.name]:{})})}if(i.itemOptions){c.each(i.itemOptions,function(j,k){g[j]=c.extend({},g[j]||{},k)})}i.itemOptions=g;if(i.configForm){this.$element.emapConfigForm(i)}else{this.$element.emapForm("destroy");this.$element.emapForm(i)}this.$element.data("jwForm-options",i);if(c.type(i.afterEmapFormInit)==="function"){i.afterEmapFormInit(this.$element)}if(c.type(i.defaultValue)==="object"){if(i.configForm){this.$element.emapConfigForm("setValue",i.defaultValue)}else{this.$element.emapForm("setValue",i.defaultValue)}}if(c.type(i.afterFormInit)==="function"){i.afterFormInit(this.$element)}}e.prototype.validate=function(){return this.$element.emapValidate("validate")};return e})();function d(e){if(/^(\/sys\/).*/.test(e)){return context_path+e}else{if(/^(sys\/).*/.test(e)){return context_path+"/"+e}else{return WIS_EMAP_SERV.getAbsPath(e)}}}function a(e){var g=c.extend(true,{action:null,pagePath:null,data:null},e);if(!g.data&&(!g.action||!g.pagePath)){console.error("缺少必传参数！(pagePath,action和data必须填入一个)");return null}g.data=g.data||WIS_EMAP_SERV.getModel(g.pagePath,g.action,"form",e.params);var h=c.extend(true,[],g.hiddenCols);var f=c.extend(true,[],g.onlyCols);g.data=g.data.filter(function(i){return h.indexOf(i.name)<0&&(f.length<=0||f.indexOf(i.name)>=0)});c.each(g.data,function(i,j){if(!j.xtype&&j["form.xtype"]==="textarea"){j.xtype=j["form.xtype"]}if(c.type(g.autocompleteCols)==="array"){c.each(g.autocompleteCols,function(k,l){if(j.name===l.name){j.xtype="selecttable";delete j.dataSize}})}});if(g.changeDataModel){g.data=g.changeDataModel(g.data)}return g}c.fn.jwForm=function(f,h){var e;e=this.data("jwForm");if(!e||(c.type(f)==="object"&&f.forceInit===true)){return this.each(function(){return c(this).data("jwForm",new b(this,f))})}if(f===true){return e}if(c.type(f)==="string"){if(e[f]){return e[f](h)}else{var g=this.data("jwForm-options");if(g&&g.configForm){return this.emapConfigForm(f,h)}else{return this.emapForm(f,h)}}}return this};c.fn.jwForm.defaults={pagePath:null,action:null,data:null,changeDataModel:null,forceInit:false,hiddenCols:[],onlyCols:[],defaultValue:null,autocompleteCols:[],model:"v",autoCheck:true,textareaEasyCheck:true,afterEmapFormInit:function(e){},afterFormInit:function(e){}};c.extend({jwWinForm:function(g){var i=c.extend(true,{},{tpl:'<div class="jwform-window-form"></div>',buttons:[],okText:"",callback:null,cancelText:g.okText&&g.okText.length>0?"取消":"关闭"},g);if(!i.title){console.error("缺少必传参数！(标题[title]必填)");return null}if(i.okText&&i.okText.length>0&&c.type(i.callback)!=="function"){console.warn("设置确认按钮后，回调函数[callback:function(formValue, $form, $target, $window)]必填")}i=a(i);i.isDatamodelProcessed=true;if(c.type(i.data)!=="array"){console.error("模型参数[data]格式不正确！");return null}if(!i.height){i.height=140;c.each(i.data,function(l,n){var m=n.hidden===undefined?false:n.hidden;if(n["form.hidden"]!==undefined){m=n["form.hidden"]}if(!m){i.height+=100}})}i.height=i.height+"";var j={text:"",className:"bh-btn-default",needValidate:true,callback:function(n,m,l,o){console.log("formValue:",n,"$form:",m)}};if(i.okText&&i.okText.length>0){var h={text:i.okText,className:"bh-btn-primary"};if(i.callback){h.callback=i.callback}i.buttons.unshift(h)}if(i.cancelText&&i.cancelText.length>0){i.buttons.push({text:i.cancelText,className:"bh-btn-default",needValidate:false,callback:function(){}})}c.each(i.buttons,function(l,m){m=c.extend({},j,m);var n=m.callback;m.callback=function(o,r){var p=o.find(".jwform-window-form");if(m.needValidate&&!p.jwForm("validate")){return false}var q=p.jwForm("getValue");if(c.type(n)==="function"){return(n(q,p,c(r),o)+"")!=="false"}};i.buttons[l]=m});var k={};c.each(i,function(l,m){if(l==="resizable"||l==="isModal"||l==="modalOpacity"||l==="height"||l==="width"||l==="zIndex"||l==="maxHeight"||l==="maxWidth"||l==="autoOpen"||l==="inIframe"){k[l]=m}});var e=BH_UTILS.bhWindow(i.tpl,i.title,i.buttons,k);delete i.buttons;delete i.okText;delete i.callback;delete i.cancelText;delete i.title;delete i.tpl;delete i.height;var f=e.find(".jwform-window-form");if(f.length<=0){console.error("设置的模板[tpl]中需包含class为“jwform-window-form”的元素！");return null}f.jwForm(i);return f}})})(jQuery);(function(a){a.fn.extend({jwChangeHead:function(h){var m=a(this);if(!h.linkage){console.error("publicHeadLinkage：缺少必要参数");return false}if(!h.isNeedSave){h.isNeedSave=false}if(!h.outTime){h.outTime=10}var d=function(n){if(n===null||n===undefined||n===""){return""}return n};var e=function(n){if(n===null||n===undefined||n===""){return true}return false};var g=function(){var p=[];var n="0123456789abcdef";for(var o=0;o<36;o++){p[o]=n.substr(Math.floor(Math.random()*16),1)}p[14]="4";p[19]=n.substr((p[19]&3)|8,1);p[8]=p[13]=p[18]=p[23]="";return p.join("")};h.key=g();h.linkageLength=h.linkage.length;var f=function(o,n,s,r){var p=WIS_CONFIG.APPNAME+"_"+o;var q=n+"||"+s+"||"+r;var t=new Date();t.setTime(t.getTime()+h.outTime*24*60*60*1000);document.cookie=p+"="+escape(q)+";expires="+t.toGMTString()};var j=function(n){var p=WIS_CONFIG.APPNAME+"_"+n;var r=document.cookie;var s=r.split("; ");for(var o=0;o<s.length;o++){var q=s[o].split("=");if(q[0]==p){return unescape(q[1])}}return null};var b=function(){var o=a("."+h.key+"-head-linkage");if(!o||o.length==0){console.error("元素不存在");return null}var n={};var q=[];var p=null;a.each(o.find(".head-linkage-item"),function(r,s){p=a(s);if(p.attr("value")){n[p.attr("data-field")]={};n[p.attr("data-field")].DM=p.attr("value");n[p.attr("data-field")].MC=p.attr("mcvalue");n[p.attr("data-field")].DATA=JSON.parse(unescape(p.attr("datavalue")));n[p.attr("data-field")].DATASTR=unescape(p.attr("datavalue"));q.push({name:p.attr("data-field"),value:p.attr("value"),builder:"m_value_equal",linkOpt:"and"})}});n.querySetting=JSON.stringify(q);return n};var i={};var l=function(n){var o=j(n.fieldCode);if(o){var p=o.split("||");if(p.length>2){if(p[0]&&p[1]&&p[2]){n.defaultParam.DMValue=p[0];n.defaultParam.MCValue=p[1];n.defaultParam.DATA=p[2]}}}return n};var c=function(){var n='<div class="'+h.key+'-head-linkage head-linkage" style="margin-left: 20px;color: #bbb;display: inline-block; font-size: 12px;font-weight: normal;">';a.each(h.linkage,function(u,t){if(h.isNeedSave){t=l(t)}var r={};if(t.defaultParam.queryParam){r=t.defaultParam.queryParam}else{if(t.requiredParent){a.each(t.requiredParent,function(z,y){if(t.otherParentName[y]){r[t.otherParentName[y]]=i[y].DM}})}else{a.each(h.linkage,function(z,y){if(y.level<t.level){if(t.otherParentName[y.fieldCode]){r[t.otherParentName[y.fieldCode]]=i[y.fieldCode].DM}}})}}r=a.extend({},r,t.extParam);if(t.mustParent){var q=true;a.each(t.mustParent,function(y,z){if(e(r[z])){q=false;return false}});if(!q){if(t.title){a.bhTip({content:t.title,state:"warning"})}else{console.warn("缺少联动必传参数")}return false}}var w={};w=r;var v={url:t.defaultParam.url?t.defaultParam.url:t.children.url,action:t.defaultParam.action?t.defaultParam.action:t.children.action,DM:t.defaultParam.DM?t.defaultParam.DM:t.children.DM,MC:t.defaultParam.MC?t.defaultParam.MC:t.children.MC};if(t.defaultParam.DMValue){w[v.DM]=t.defaultParam.DMValue;i[t.fieldCode]={DM:t.defaultParam.DMValue,MC:t.defaultParam.MCValue,DATA:t.defaultParam.DATA}}var p=BH_UTILS.doSyncAjax(v.url,w);if(p.code=="0"){if(!t.defaultParam.selectedIndex){t.defaultParam.selectedIndex=0}var x=p.datas[v.action].rows[t.defaultParam.selectedIndex];if(!x&&t.defaultParam.DMValue){delete w[v.DM];var s=BH_UTILS.doSyncAjax(v.url,w);if(s.code=="0"){if(!t.defaultParam.selectedIndex){t.defaultParam.selectedIndex=0}var x=s.datas[v.action].rows[t.defaultParam.selectedIndex];if(!x){a.bhTip({content:"不存在"+t.fieldName,state:"danger"});i[t.fieldCode]={DM:"*",MC:"请更改"+t.fieldName,DATA:"{}"}}else{i[t.fieldCode]={DM:x[v.DM],MC:x[v.MC],DATA:JSON.stringify(x)}}}else{a.bhTip({content:"请求动作出错",state:"danger"});return false}}else{if(!x){a.bhTip({content:"不存在"+t.fieldName,state:"danger"});i[t.fieldCode]={DM:"*",MC:"请更改"+t.fieldName,DATA:"{}"}}else{i[t.fieldCode]={DM:x[v.DM],MC:x[v.MC],DATA:JSON.stringify(x)}}}}else{a.bhTip({content:"请求动作出错",state:"danger"});return false}if(w.ZCSDM&&t.defaultParam.DMValue&&h.isNeedSave){i[t.fieldCode]={DM:t.defaultParam.DMValue,MC:t.defaultParam.MCValue,DATA:t.defaultParam.DATA}}if(e(t.isShow)){t.isShow=true}if(t.isShow){n+='<span class="head-linkage-item" data-field="'+t.fieldCode+'" data-dm="'+d(i[t.fieldCode].DM)+'" value="'+d(i[t.fieldCode].DM)+'" mcvalue="'+d(i[t.fieldCode].MC)+'" datavalue="'+escape(d(i[t.fieldCode].DATA))+'"> '+d(i[t.fieldCode].MC)+"</span>/"}else{n+='<span  style = "display: none;" class="head-linkage-item" data-field="'+t.fieldCode+'" data-dm="'+d(i[t.fieldCode].DM)+'" value="'+d(i[t.fieldCode].DM)+'" mcvalue="'+d(i[t.fieldCode].MC)+'" datavalue="'+escape(d(i[t.fieldCode].DATA))+'"> '+d(i[t.fieldCode].MC)+"</span>"}});n=n.substring(0,n.length-1);n+='<a class="'+h.key+'-head-a-adjust" style="padding-left: 10px;cursor: pointer;">更改</a>';n+="</div>";m.append(n);var o=b();if(h.isNeedSave){a.each(h.linkage,function(p,q){f(q.fieldCode,o[q.fieldCode].DM,o[q.fieldCode].MC,o[q.fieldCode].DATASTR)})}if(h.initCallback){h.initCallback(o)}};c();var k=function(){var o='<div class="'+h.key+'-head-select-group" style="padding-top: 30px;">';a.each(h.linkage,function(t,u){o+='<div class="head-select-item" style="margin-bottom: 20px;"><div class="bh-advancedQuery-groupName name_left" style="width: 20%;">'+u.fieldName+'：</div><div class="bh-advancedQuery-groupList bh-label-radio-group"><div class="dropdowm-list" data-fieldname="'+u.fieldName+'" data-name="'+u.fieldCode+'"></div></div></div>'});o+="</div>";BH_UTILS.bhWindow(o,h.title,[{text:"确定",className:"bh-btn-primary",callback:function(){p();o='<div class="'+h.key+'-head-linkage head-linkage" style="margin-left: 20px;color: #bbb;display: inline-block; font-size: 12px;font-weight: normal;">';var u=true;a.each(h.linkage,function(v,w){if(String(w.require)!="false"&&(!i[w.fieldCode]||!i[w.fieldCode].DM)){a.bhTip({content:"请选择"+w.fieldName,state:"warning"});u=false;return false}if(e(w.isShow)){w.isShow=true}if(w.isShow){o+='<span class="head-linkage-item" data-field="'+w.fieldCode+'" data-dm="'+d(i[w.fieldCode].DM)+'" value="'+d(i[w.fieldCode].DM)+'" mcvalue="'+d(i[w.fieldCode].MC)+'" datavalue="'+escape(d(i[w.fieldCode].DATA))+'"> '+d(i[w.fieldCode].MC)+"</span>/"}else{o+='<span  style = "display: none;" class="head-linkage-item" data-field="'+w.fieldCode+'" data-dm="'+d(i[w.fieldCode].DM)+'" value="'+d(i[w.fieldCode].DM)+'" mcvalue="'+d(i[w.fieldCode].MC)+'" datavalue="'+escape(d(i[w.fieldCode].DATA))+'"> '+d(i[w.fieldCode].MC)+"</span>"}});if(u){o=o.substring(0,o.length-1);o+='<a class="'+h.key+'-head-a-adjust" style="padding-left: 10px;cursor: pointer;">更改</a>';o+="</div>";a("."+h.key+"-head-linkage").replaceWith(o);var t=b();if(h.isNeedSave){a.each(h.linkage,function(v,w){f(w.fieldCode,t[w.fieldCode].DM,t[w.fieldCode].MC,t[w.fieldCode].DATASTR)})}if(h.changeCallback){h.changeCallback(t)}else{if(h.initCallback){h.initCallback(t)}}}else{return false}}},{text:"取消",className:"bh-btn-default",callback:function(){}}],{height:300,width:500});i={};var n=function(){i={};var t=null;a.each(a("."+h.key+"-head-linkage").find(".head-linkage-item"),function(u,v){t=a(v);i[t.attr("data-field")]={DM:t.attr("value"),MC:t.text(),DATA:t.attr("datavalue")}})};n();var p=function(u){i={};var t=null;a.each(a("."+h.key+"-head-select-group").find(".dropdowm-list"),function(w,v){t=a(v).jqxDropDownList("getSelectedItem");if(t){i[a(v).attr("data-name")]={DM:t.value.value,MC:t.label,DATA:t.value.data}}if(u&&a(v).attr("data-name")==u){return false}})};var q=function(t){a.each(h.linkage,function(v,u){if(u.level>=t){sourceArr=[];if(String(u.needPleaseChoose)!=="false"){sourceArr.push({label:"请选择",value:{value:"",data:"{}"}})}if(a("."+h.key+'-head-select-group [data-name="'+u.fieldCode+'"]').length>0){a("."+h.key+'-head-select-group [data-name="'+u.fieldCode+'"]').jqxDropDownList({source:sourceArr,selectedIndex:0})}}})};var s=function(B,x){var v={};if(B.requiredParent){a.each(B.requiredParent,function(D,C){if(B.otherParentName[C]){v[B.otherParentName[C]]=i[C].DM}})}else{a.each(h.linkage,function(D,C){if(C.level<B.level){if(B.otherParentName[C.fieldCode]){v[B.otherParentName[C.fieldCode]]=i[C.fieldCode].DM}}})}v=a.extend({},v,B.extParam);if(B.mustParent){var u=true;a.each(B.mustParent,function(C,D){if(e(v[D])){u=false;return false}});if(!u){if(B.title){a.bhTip({content:obj.title,state:"warning"})}else{console.warn("缺少联动必传参数")}q(B.level);return false}}var z={};z=v;var y={url:B.children.url,action:B.children.action,DM:B.children.DM,MC:B.children.MC};var t=BH_UTILS.doSyncAjax(y.url,z);if(t.code=="0"){var w=-1;var A=[];a.each(t.datas[y.action].rows,function(C,D){A.push({label:d(D[y.MC]),value:{value:d(D[y.DM]),data:JSON.stringify(D)}});if(x&&D[y.DM]==i[B.fieldCode].DM){w=C}});if(String(B.needPleaseChoose)!=="false"){A.unshift({label:"请选择",value:{value:"",data:"{}"}});w++}if(w==-1){w=0}if(x){a("."+h.key+'-head-select-group [data-name="'+B.fieldCode+'"]').jqxDropDownList({source:A,selectedIndex:w,placeHolder:"请选择",filterable:true,filterPlaceHolder:"搜索",searchMode:"contains"})}else{a("."+h.key+'-head-select-group [data-name="'+B.fieldCode+'"]').jqxDropDownList({source:A,selectedIndex:w});q(B.level+1)}}else{a.bhTip({content:"请求动作出错",state:"danger"});return false}};a.each(h.linkage,function(t,u){s(u,true)});if(!h.bindEventType){h.bindEventType="close"}var r=function(u){var t=a(u.currentTarget).attr("data-name");a.each(h.linkage,function(v,w){if(t==w.fieldCode&&v<h.linkageLength-1){p(t);a.each(h.linkage,function(y,x){if(x.level>w.level){s(x,false)}})}})};a("."+h.key+"-head-select-group .dropdowm-list").off(h.bindEventType).on(h.bindEventType,r)};a("body").off("click","."+h.key+"-head-a-adjust").on("click","."+h.key+"-head-a-adjust",function(n){k()})}})})(jQuery);(function(a){a.fn.extend({jwXnxqHead:function(d){var b=a(this);if(!d.zcsdm){console.error("jwXnxqHead：缺少初始化参数");return false}if(!d.initCallback||!typeof(d.initCallback)=="function"){console.error("jwXnxqHead：缺少初始化回调方法");return false}if(!d.changeCallback){d.changeCallback=d.initCallback}if(!d.title){d.title="更改学年学期"}var c={DM:"XNXQDM",MC:"XNXQMC",action:"cxmrxnxq",url:context_path+(d.url||"/sys/jwpubapp/modules/gg/cxmrxnxq.do"),queryParam:{ZCSDM:d.zcsdm,CSDM:d.csdm}};var e={title:d.title,isNeedSave:d.isNeedSave,initCallback:function(g){var f={XNXQDM:g.XNXQDM.DM,XNXQMC:g.XNXQDM.MC};d.initCallback(f)},changeCallback:function(g){var f={XNXQDM:g.XNXQDM.DM,XNXQMC:g.XNXQDM.MC};d.changeCallback(f)},linkage:[{level:1,fieldCode:"XNXQDM",fieldName:"学年学期",defaultParam:c,children:{DM:"DM",MC:"MC",action:"xnxqcx",url:context_path+"/sys/jwpubapp/modules/zdgl/xnxqcx.do"},extParam:{SFSY:"1","*order":"-DM"}}]};b.jwChangeHead(e)}})})(jQuery);(function(a){a.fn.extend({jwdwHead:function(d){var b=a(this);if(!d.initCallback||!typeof(d.initCallback)=="function"){console.error("jwXnxqHead：缺少初始化回调方法");return false}if(!d.changeCallback){d.changeCallback=d.initCallback}if(!d.title){d.title="更改院系"}var c={};var e={title:d.title,initCallback:function(g){console.log(g);var f={YXDM:g.YXDM.DM,YXMC:g.YXDM.MC};d.initCallback(f)},changeCallback:function(g){console.log(g);var f={YXDM:g.YXDM.DM,YXMC:g.YXDM.MC};d.changeCallback(f)},linkage:[{level:1,fieldCode:"YXDM",fieldName:"管理单位",defaultParam:c,children:{DM:"YXDM",MC:"YXMC",action:"cxxygjyhqueryAcademyByUser",url:context_path+"/sys/jwpubapp/modules/zdgl/cxxygjyhqueryAcademyByUser.do"},extParam:{SFJXDW:"1"}}]};b.jwChangeHead(e)}})})(jQuery);(function(a){a.extend({jwDoPost:function(c,g,e){var f=document.createElement("form");f.action=c;f.target=e?e:"_blank";f.method="post";f.style.display="none";for(var d in g){var b=document.createElement("input");b.name=d;b.value=g[d];f.appendChild(b)}document.body.appendChild(f);f.submit()}})})(jQuery);(function(a){a.extend({showJzReport2:function(c,d){var b=WIS_CONFIG.ROOT_PATH+"/sys/jzreport2_client/client/word/jw/"+c+".do";a.jwDoPost(b,d)}})})(jQuery);(function(a){a.fn.extend({jwBusinessLog:function(c){var b=a(this);var d=c.params||{};if(c.keyItemName){d.keyItemName=c.keyItemName}if(c.keyItemCodeName){d.keyItemCodeName=c.keyItemCodeName}if(c.functionId){d.GNID=c.functionId}if(c.businessId){d.YWZJ=c.businessId}b.jwQueryAndTable({pagePath:c.pagePath||"../jwcommon/modules/public.do",action:c.actionName||"cxggywrz",params:d,emapQuery:{expanded:false},buttons:[{text:"详情",className:"bh-btn-default businessLogDetail",canSingle:true,canBatch:false,beforeRender:function(e,f){if(f.CZLX=="3"){return true}return false},callback:function(f,e){var h=f.records[0];var i="logDetail"+h.WID;var g="<div id='"+i+"'></div>";BH_UTILS.bhWindow(g,"变更明细",[{text:"关闭",className:"bh-btn-default",callback:function(){}}],{height:600,width:900});a("#"+i).jwQueryAndTable(a.extend({pagePath:c.detailPagePath||"../jwcommon/modules/public.do",action:c.detailActionName||"ckrzxq",emapQuery:{expanded:false},params:{RZID:h.WID}},c.detailOpts))}}]})}});a.extend({jwBusinessLogWin:function(d,b){if(!b){b={}}var e=(d.appName||WIS_CONFIG.APPNAME)+"-"+d.functionId;var c="<div id='"+e+"'></div>";BH_UTILS.bhWindow(c,(d.title||"查看日志"),[{text:"关闭",className:"bh-btn-default",callback:function(){}}],{height:(b.height||638),width:(b.width||1000)});a("#"+e).jwBusinessLog(d)}})})(jQuery);(function(f,d){var e=(function(){function g(i,m){this.$element=f(i);var A=f.extend(true,{},f.fn.jwQueryCard.defaults,m);var C={};if(A.hasSearch&&!A.emapQuery.data){A.emapQuery.data=WIS_EMAP_SERV.getModel(A.pagePath,A.action,"search",A.params);A.emapQuery.data.controls=A.emapQuery.data.controls.filter(function(E){C[E.name]=E.caption;return !E["search.hidden"]})}var y=WIS_EMAP_SERV.getModel(A.pagePath,A.action,"grid",A.params);y.filter(function(E){C[E.name]=E.caption});if(A.hasSearch){var p=[];f.each(A.complexSearchCols,function(F,G){var E=false;f.each(A.emapQuery.data.controls,function(H,I){if(I.name===G){var J=I["search.xtype"]||I.xtype;E=I.dataType==="String"&&(!J||J==="text");return false}});if(E){p.push(G)}});A.complexSearchCols=p;var o=[];if(A.searchType==="emapFilterQuery"){f.each(A.emapQuery.data.controls,function(E,F){if(F.quickSearch===true&&A.requiredCols.indexOf(F.name)>=0){o.push(F)}});var j="";f.each(A.requiredCols,function(E,G){var F=false;f.each(o,function(H,I){if(G===I.name){F=true;return false}});if(!F){if(j.length>0){j+=","}j+=G}});if(j.length>0){console.warn("【requiredCols】中设置的【"+j+"】字段不存在在于搜索模型中或没有设置为快速搜索")}}}this.$element.html(A.tpl);var D=this.$element.find(".jwquerycard-btns");var u=this.$element.find(".jwquerycard-search");var B=BH_UTILS.NewGuid();u.addClass(B);var s=u.selector+"."+B;var r=this.$element.find(".jwquerycard-table");var z=this.$element;var v={text:"",className:"bh-btn-default",canBatch:true,canSingle:false,needValidateCheckedRecords:true,beforeRender:null,callback:function(F,E){console.log("checkedOrSearchQuerySetting:",F,"$target:",E)}};f.each(A.buttons,function(E,F){A.buttons[E]=f.extend({},v,F)});f.each(A.buttons,function(E,F){if(F.children){F.children=F.children.filter(function(G){return !G.permissionKey||f.jwAppConfig.hasPermission(G.permissionKey)});if(F.children.length<=0){F.shouldHidden=true}}});A.buttons=A.buttons.filter(function(E){return(!E.permissionKey||f.jwAppConfig.hasPermission(E.permissionKey))&&!E.shouldHidden});var h='<div class="bh-pull-left bh-mb-8">';var q=[];f.each(A.buttons,function(E,F){if(F.canBatch){if(F.children&&F.children.length>0){h+='<div class="bh-dropdown '+F.className.replace(/bh-btn-/g,"bh-dropdown-")+'" bh-dropdown-role="bhDropdown" style="display: inline-block;margin-left: 4px;">    <button class="bh-btn '+F.className+' bh-btn-larger" type="button" bh-dropdown-role="bhDropdownBtn" >'+F.text+'    </button>    <ul class="bh-dropdown-menu" bh-dropdown-role="bhDropdownMenu">';f.each(F.children,function(H,G){h+='<li><a href="javascript:void(0)" class="jwquerycard-button-'+E+"-"+H+'" >'+G.text+"</a></li>";D.on("click",".jwquerycard-button-"+E+"-"+H,function(){var I=b(z,A);if((G.needValidateCheckedRecords==null||G.needValidateCheckedRecords)&&!I.hasRecord){f.bhTip({content:"没有可操作的记录!",state:"danger"});return false}G.callback(I,f(this))})});h+="</ul></div>"}else{h+='<a href="javascript:void(0)" class="bh-btn '+F.className+" jwquerycard-button-"+E+'" >'+F.text+"</a>";D.on("click",".jwquerycard-button-"+E,function(){var G=b(z,A);if(F.needValidateCheckedRecords&&!G.hasRecord){f.bhTip({content:"没有可操作的记录!",state:"danger"});return false}F.callback(f.extend({},G,{isSingle:false}),f(this))})}}if(F.canSingle&&!F.children){q.push(F)}});h+="</div>";D.append(h).append('<div class="bh-clearfix"></div>');if(A.hasSearch&&u.length>0){var l={njColName:false,yxColName:false,zyColName:false,zyfxColName:false,bjColName:false};f.each(A.emapQuery.data.controls,function(E,F){if(A.autoLink){f.each(l,function(G,H){if(F.name===A[G]){l[G]=true}})}if(!F["search.xtype"]){switch(F.dataType){case"double":case"int":case"long":F["search.xtype"]="number-range";break;case"Timestamp":case"Date":F["search.xtype"]="date-range";break}}});var x=A.emapQuery.onSearch;delete A.emapQuery.onSearch;var n=A.emapQuery.beforeSearch;delete A.emapQuery.beforeSearch;A.emapQuery.onSearch=function(F){if(n&&f.type(n)==="function"){if(n(F)===false){return}}var E="";f.each(o,function(H,J){var I=u.find('[data-name="'+J.name+'"]');var K=I.val();if(K===null||K===undefined||K===""){if(E.length>0){E+="、"}E+=J.caption}});if(E.length>0){f.bhTip({content:E+"不能为空",state:"danger"});return false}r.show();D.show();var G=a(z,F);if(x){x(F)}else{r.emapCard("reload",G,true)}};if(l.njColName&&l.yxColName&&l.zyColName){var w=A.emapQuery.afterRender;A.emapQuery.afterRender=function(){f.autoLinkStuSearch(s,{XZNJ:A.njColName,YXDM:A.yxColName,ZYDM:A.zyColName,ZYFXDM:A.zyfxColName,BJDM:A.bjColName},l.zyfxColName,l.bjColName);if(f.type(w)==="function"){w()}}}var t=A.emapQuery.afterRender;A.emapQuery.afterRender=function(){f.each(A.complexSearchCols,function(F,G){var E=u.find('div[data-field="'+G+'"]');E.find(".emap-FQ-label").css("color","#2196F3").css("cursor","pointer");E.off("click",".emap-FQ-label").on("click",".emap-FQ-label",function(L){var I=f(L.currentTarget);var M=I.parent().find("[data-name][data-caption]");var K=I.html();var H=M.val();var J=BH_UTILS.bhWindow('<div class="bh-alert bh-alert-warning">    <p>1. 每行代表一个【'+K+'】，可从其他途径复制粘贴</p>    <p>2. 重复项只会被保留一个</p>    <p>3. 每项的前后空格将会被去除</p></div><textarea class="textarea"></textarea>',K+"（批量查询）",[{text:"确定",className:"bh-btn-primary",callback:function(){var O=J.find(".textarea").val().split(/\n/g);for(var N=0;N<O.length;N++){O[N]=O[N].trim();if(O[N]===""){O.splice(N,1)}}O=O.filter(function(Q,P){return O.indexOf(Q)===P});M.val(O.toString())}}],{height:"580px"});J.find(".textarea").jqxTextArea({height:350});J.find(".textarea").val(H.replace(/,/g,"\n"))})});if(f.type(t)==="function"){t()}};u.emapFilterQuery(A.emapQuery);if(!A.showSearchKey){u.find('[data-field="_commonFilter"]').hide()}if(A.params&&A.params.querySetting){u.emapFilterQuery("setValue",A.params.querySetting)}}if(A.hasSearch&&A.searchType==="emapFilterQuery"&&u.length>0){f.each(o,function(E,G){var F=u.find('div[data-field="'+G.name+'"]');if(F.length===0){return true}F.find(".emap-FQ-label").prepend('<span style="color: #f00;margin-right: 3px;">*</span>')});if(o.length>0){r.hide();D.hide();A.emapTable.isOnceEmpty=true}}A.emapTable.customColumns=A.emapTable.customColumns||[];var k='<div class="jwquerycard-content" id="WID{{WID}}" data-wid="{{WID}}"></div>';r.emapCard({pagePath:A.pagePath,action:A.action,template:Hogan.compile(k),pageable:A.pageable,pageSize:10,pageSizeOptions:["10","20","50"],params:m.params,cardBeforeRender:m.cardBeforeRender,cardAfterRender:function(){var F=r.find(".jwquerycard-content");var E=r.emapCard("getResult").datas[A.action].rows;F.map(function(L,P){var W=E[L];var Q=[];if(m.tags){m.tags.map(function(aa,Y){var Z="";if(aa.customFunction){Z=aa.customFunction(W)}else{Z=W[aa.fieldName+"_DISPLAY"]||W[aa.fieldName]}var ab=aa.className;if(typeof(aa.className)=="function"){ab=aa.className(W)}Q.push({label:Z,className:ab,color:aa.color})})}var O=[];if(m.subHeaders){m.subHeaders.map(function(Z,aa){var Y=[];Z.map(function(ad,ab){var ac="";if(typeof(ad)=="function"){ac=ad(W)}else{ac=C[ad]+"："+(W[ad+"_DISPLAY"]||W[ad]||"")}Y.push(ac)});O.push(Y)})}else{var K={};var N=[];var U=false;var G=m.subHeadersHide||[];y.filter(function(Z){var Y=true;if(null!==Z.hidden&&undefined!==Z.hidden){Y=!Z.hidden}if(null!==Z["grid.hidden"]&&undefined!==Z["grid.hidden"]){Y=!Z["grid.hidden"]}if(Y&&G.indexOf(Z.name)<0){N.push(Z.name);if(Z.groupName){if(K[Z.groupName]){K[Z.groupName].push(Z.name)}else{K[Z.groupName]=[Z.name]}U=true}}});if(U){for(var V in K){var H=[];K[V].map(function(Z,Y){H.push(C[Z]+"："+(W[Z+"_DISPLAY"]||W[Z]||""))});O.push(H)}}else{var H=[];N.map(function(Z,Y){H.push(C[Z]+"："+(W[Z+"_DISPLAY"]||W[Z]||""))});O.push(H)}}var T=[];if(m.buttons){f.each(q,function(Y,Z){if(Z.beforeRender&&f.type(Z.beforeRender)==="function"&&!Z.beforeRender(Z,W)){return true}T.push({name:Z.text,onClick:function(){var ab=f.extend({},A.emapTable.params||{},r.data("initParams"));var aa=c(ab)||[];aa.push({name:A.emapTable.pk,value:W[A.emapTable.pk],builder:"equal",linkOpt:"and"});Z.callback({querySetting:JSON.stringify(aa),isChecked:false,isSingle:true,hasRecord:true,isRowSelected:false,records:[W]})}})})}var M;if(m.quickSwitch&&(!m.quickSwitch.permissionKey||f.jwAppConfig.hasPermission(m.quickSwitch.permissionKey))){M=f.extend({},m.quickSwitch,{checked:m.quickSwitch.getChecked(W)});if(m.quickSwitch.beforeRender&&f.type(m.quickSwitch.beforeRender)==="function"&&!m.quickSwitch.beforeRender(W)){M=undefined}}var J;if(m.contentRender){J=function(Y){m.contentRender(W,Y)}}var R;if(m.quickProgress){R=m.quickProgress(W)}var I;if(m.quickCheckBox){I=m.quickCheckBox}var X="";if(m.title){if(typeof(m.title)=="function"){X=m.title(W)}else{X=W[m.title+"_DISPLAY"]||W[m.title]}}var S={title:X,subHeaders:O,itemData:W,contentRender:J,quickSwitch:M,tags:Q,bottomOperations:T,quickCheckBox:I,quickProgress:R};S=Object.assign({},m,S);JWP.loadQueryCard(function(Y){Y(f(P).attr("id"),S)})});if(m.cardAfterRender){m.cardAfterRender()}}});z.data("jwQueryCard-options",A)}g.prototype.refreshCard=function(o){var j=this.$element.data("jwQueryCard-options");var m=this.$element.find(".jwquerycard-search");var i=this.$element.find(".jwquerycard-table");var h=null;if(o&&o.querySetting){h=o.querySetting}o=f.extend({},j.emapTable.params||{},i.data("initParams"),{_gotoFirstPage:true},o);delete o.querySetting;i.data("initParams",o);var l=f.extend({},o);if(h){l.querySetting=h}if(j.hasSearch&&m.length>0){var k=l.querySetting;l.querySetting=m.emapFilterQuery("getValue");if(k){var n=JSON.parse(l.querySetting);n.push(JSON.parse(k));l.querySetting=JSON.stringify(n)}}i.emapCard("reload",l)};g.prototype.getValue=function(){return this.$element.data("value")};return g})();f.fn.jwQueryCard=function(h,i){var g;g=this.data("jwQueryCard");if(!g||(f.type(h)==="object")){return this.each(function(){return f(this).data("jwQueryCard",new e(this,h))})}if(h===true){return g}if(f.type(h)==="string"){if(g[h]){return g[h](i)}else{return this.emapCard(h,i)}}return this};function b(n,i){var p=i.searchType;var m=i.$searchDom||n.find(".jwquerycard-search");var r=i.$tableDom||n.find(".jwquerycard-table");var k=i.emapTable.pk;var j=f.extend({},i.emapTable.params||{},r.data("initParams"));var h=c(j)||[];var l=[];var o=r.find(".cykpDivSelectCheckbox:checked");if(o.length>0){var g=[];f.each(o,function(s,t){g.push(f(t).attr("data-wid"))});h.push({name:k,value:g.join(","),builder:"m_value_equal",linkOpt:"and"});return{querySetting:JSON.stringify(h),isChecked:true,hasRecord:true,records:g}}else{if(i.hasSearch&&m.length>0){var q=a(n,m[p]("getValue"));if(q.querySetting){h.push(JSON.parse(q.querySetting))}}else{if(i&&i.params&&i.params.querySetting){h.push(JSON.parse(i.params.querySetting))}}return{querySetting:JSON.stringify(h),isChecked:false,hasRecord:[],records:[]}}}function c(h){if(h&&f.type(h)==="object"){var g=[];f.each(h,function(i,j){if(f.type(j)!=="string"&&f.type(j)!=="number"){console.warn("params中【"+i+"】参数不是字符串或数值，将被忽略。"+i+":",j);return true}if(i!=="querySetting"&&i!=="*order"&&i!=="_gotoFirstPage"){g.push({name:i,value:j,builder:j.indexOf(",")>-1?"m_value_equal":"equal",linkOpt:"and"})}});return g}return null}function a(l,h){var i=l.data("jwQueryCard-options");var j=l.find(".jwquerycard-table");h=h||j[i.searchType]("getValue");var g=JSON.parse(h);var k={querySetting:JSON.stringify(g)};return k}f.fn.jwQueryCard.defaults={pagePath:null,action:null,forceInit:false,hiddenCols:[],onlyCols:[],params:null,tpl:'<div class="jwquerycard-search"></div><div class="jwquerycard-btns"></div><div class="jwquerycard-checked-container"></div><div class="jwquerycard-table"></div>',$tableDom:null,$searchDom:null,$buttonsDom:null,$checkedContainerDom:null,needPermission:true,buttons:[],hasSearch:true,requiredCols:[],complexSearchCols:[],hasZdyl:true,hasCheckbox:true,isPageableCheck:false,checkedLableName:null,defaultCheckedRecords:[],hasExport:false,hasExportPermission:"",searchType:"emapFilterQuery",autoLink:true,njColName:"XZNJ",yxColName:"YXDM",zyColName:"ZYDM",zyfxColName:"ZYFXDM",bjColName:"BJDM",showSearchKey:false,changeDataModel:null,emapQuery:{showBlankOption:false,showTotalNum:true,beforeSearch:null,onSearch:null},emapTable:{pk:"WID",fastRender:true,sortable:true,height:null,minLineNum:10,rendered:function(){}}}})(jQuery,require);(function(d){var a=(function(){function f(p,v){this.$element=d(p);var k=d.extend(true,{},d.fn.jwStepBar.defaults,v);if(!k.items){console.error("缺少必传参数！(items)");return null}var u="step";var s=[];var j="";var m=[];var l="";var n="";for(var o=0;o<k.items.length;o++){var h=k.items[o];h.stepId=u+(o+1);if(!h.title){console.error("缺少标题！(title)");return null}if(h.isActive||o==0){j=h.stepId}if(h.isFinish){m.push(h.stepId)}if(!h.authId||(h.authId&&!d.jwAppConfig.hasPermission(h.authId))){s.push(h);l+='<div id="'+h.stepId+'" class="bh-hide"></div>'}}if(s.length==0){b(this.$element);return}var g={};var q={};for(var o=0;o<s.length;o++){var h=s[o];var r=h.buttons;r=e(h.buttons,h,s);h.buttons=r;g[h.stepId]=h;r.map(function(w,i){q[h.stepId+i]=w;n+='<a href="javascript:void(0)" class="bh-hide bh-btn '+w.className+" jwstepbarppd-btn jwstepbarppd-btn-"+h.stepId+'" data-step="'+h.stepId+'" data-index="'+i+'"> '+w.text+" </a>"})}if(v.$buttons){v.$buttons.html(n);v.$buttons.find(".jwstepbarppd-btn").click(function(y){var z=d(y.currentTarget).attr("data-step");var x=d(y.currentTarget).attr("data-index");var A=q[z+x];if(A){var w=true;if(A.callback){var i=d(".jwStepBar-index-content");w=A.callback(i.find("#"+z),g[z],v.$buttons.find('[data-step="'+z+'"][data-index="'+x+'"]'))}if(w){if(A.type=="prev"){d(p).bhStepWizard("activePrevItem")}else{if(A.type=="next"){if(g[z]&&g[z].canNext&&!g[z].canNext()){return}d(p).bhStepWizard("activeNextItem")}else{if(A.type=="finish"){d.bhPaperPileDialog.hide({close:function(){if(v.close){v.close()}}})}}}}}})}this.$element.after('<div class="jwStepBar-index-content bh-clearfix"></div>');var t=d(".jwStepBar-index-content");t.html(l);t.find("#"+j).removeClass("bh-hide");this.$element.bhStepWizard({items:s,isAddClickEvent:false,active:j,finished:m,contentContainer:t,change:function(i){s.map(function(A,x){if(A.stepId==i.stepId){c(v.$buttons,i,s);var w=t.find("#"+i.stepId);var z=w.html();var y=[];if(v.$buttons){y=v.$buttons.find('[data-step="'+A.stepId+'"]')}if(!z&&A.init){A.init(w,i,y)}if(A.active){A.active(w,i,y)}}})}});s.map(function(x,i){if(x.stepId==j){c(v.$buttons,x,s);var w=[];if(v.$buttons){w=v.$buttons.find('[data-step="'+x.stepId+'"]')}if(x.init){x.init(t.find("#"+x.stepId),x,w)}if(x.active){x.active(t.find("#"+x.stepId),x,w)}}});this.$element.children(".bh-wizard-item").unbind("click").click(function(){var x=d(this);var y=x.attr("stepid");if(y==d(p).bhStepWizard("getActiveItem")){return}var w=d(p).bhStepWizard("getFinishedIndexs");var i=Math.max.apply(null,w);if(y.replace(u,"")==1){d(p).bhStepWizard("changeToActive",y);return}if(y.replace(u,"")-2<=i){d(p).bhStepWizard("changeToActive",y);return}if(g[y]&&g[y].canClick&&g[y].canClick()){d(p).bhStepWizard("changeToActive",y);return}})}return f})();function e(l,i,m){var h={text:"",className:"bh-btn-default"};var j=true;var f=true;var g=[];if(l){l.map(function(p,o){if(p.type=="prev"){f=false}else{if(p.type=="next"){j=false}}g.push(d.extend({},h,p))})}if(f&&i.stepId!=m[0].stepId){g.unshift(d.extend({},h,{text:"上一步",type:"prev"}))}if(i.stepId!=m[m.length-1].stepId){if(j){g.push(d.extend({},h,{text:"下一步",type:"next"}))}}else{var k=false;var n=false;g.map(function(p,o){if("next"==p.type){p.type="finish";p.text="完成";k=true;n=true}else{if("finish"==p.type){n=true}}});if(!k&&!n){g.push(d.extend({},h,{text:"完成",type:"finish"}))}}return g}function c(g,h,f){if(g){g.find("a").addClass("bh-hide");g.find(".jwstepbarppd-btn-"+h.stepId).removeClass("bh-hide")}}function b(f){var g='<article bh-layout-role="single"><h2></h2><section class=""><div class="bh-text-center close_img"><img src="../../jwpubapp/public/images/cry.png"></div><div class="bh-text-center"><div class="bh-mt-24 bh-mb-8" style="font-size: 18px;">暂无权限使用</div><div class="open_time"></div></div></section> </article>';f.html(g,true)}d.fn.jwStepBar=function(g,h){var f;f=this.data("jwStepBar");if(!f||(d.type(g)==="object")){return this.each(function(){return d(this).data("jwStepBar",new a(this,g))})}if(g===true){return f}if(d.type(g)==="string"){if(f[g]){return f[g](h)}else{return this.bhStepWizard(g,h)}}return this};d.fn.jwStepBar.defaults={};d.extend({jwStepBarPaperDialog:function(f){if(!f.title){console.error("缺少标题！(title)");return null}d.bhPaperPileDialog.show({content:'<article bh-layout-role="single">\n    <h2>'+f.title+'</h2>\n    <section>\n        <div class="jwstepbarppd-wizard"></div>\n    </section>\n    <footer  bh-role="bhFooterAffix" class="jwstepbarppd-footer" style="text-align: center;">\n    </footer>\n</article>',render:function(){var g=d(".jwstepbarppd-wizard");delete f.title;f.$buttons=d(".jwstepbarppd-footer");g.jwStepBar(f)},close:function(){if(f.close){f.close()}}})}});d.extend({jwNoticeConfigDialog:function(f){if(!f.title){console.error("缺少标题！(title)");return null}if(!f.template){console.error("缺少模板！(template)");return null}if(!f.noticeId){console.error("缺少须知代码！(noticeId)");return null}if(!f.templateParams){f.templateParams={}}if(f.operateType!="review"){var i=d.jwAjax({url:"/sys/jwcommon/notice/isNeedAlarm/"+f.noticeId+"/"+f.getYwzj()+".do",data:{},async:false,successMsg:"",success:function(j){}});if(!i.datas){console.log("该用户已读且不需要再次提醒");return}}var g=f.readBtnName||"我已阅读";var h=[{text:g,className:"bh-btn-primary",callback:function(k){if(d(k.currentTarget).attr("disabled")=="disabled"){return}var j=f.getYwzj()||f.noticeId;d.jwAjax({url:"/sys/jwcommon/notice/read/"+f.noticeId+"/"+j+".do",data:{},successMsg:"",success:function(l){}})}}];d.jwAjax({url:"/sys/jwcommon/notice/config/"+f.noticeId+".do",data:{},successMsg:"",success:function(o){var l=o.datas;if(f.beforeRender&&typeof f.beforeRender=="function"){f.beforeRender(f,h,l)}var n=BH_UTILS.bhWindow(f.template.render(f.templateParams),f.title,h,{height:l.height,width:l.width});if(f.afterRender&&typeof f.afterRender=="function"){f.afterRender(n,f,h,l)}var m=n.find("#buttons").find('[type="button"]');var k=Math.ceil((l.minReadTime||0)/1000);if(k>0){m.attr("disabled","disabled");m.text(g+"("+k+")");j(m,--k)}if(!l.needCloseNoticeButton){n.find(".jqx-popover-close-button").remove()}function j(q,p){if(p==-1){q.removeAttr("disabled");q.text(g);return}setTimeout(function(){q.text(g+"("+p+")");j(q,--p)},1000)}}})}})})(jQuery);